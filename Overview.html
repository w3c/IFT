<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Incremental Font Transfer</title>
  <meta content="w3c/ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-ED" rel="stylesheet">
  <meta content="Bikeshed version c5fd42b86, updated Mon Apr 5 16:27:33 2021 -0700" name="generator">
  <link href="https://www.w3.org/TR/example/" rel="canonical">
  <meta content="b9de716b6abbfacf733b13e0d0cd587df972ff0a" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #707070;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #bbb;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Incremental Font Transfer</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="2021-08-12">12 August 2021</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/IFT/Overview.html">https://w3c.github.io/IFT/Overview.html</a>
     <dt>Latest published version:
     <dd><a href="https://www.w3.org/TR/example/">https://www.w3.org/TR/example/</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webfonts-wg@w3.org?subject=%5BPFE%5D%20YOUR%20TOPIC%20HERE">public-webfonts-wg@w3.org</a> with subject line “<kbd>[PFE] <i data-lt>… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-webfonts-wg/" rel="discussion">archives</a>)</span>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/w3c/PFE/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="1438"><a class="p-name fn u-url url" href="https://svgees.us/">Chris Lilley</a> (<span class="p-org org">W3C</span>)
     <dd class="editor p-author h-card vcard" data-editor-id="77180"><a class="p-name fn u-email email" href="mailto:mmaxfield@apple.com">Myles C. Maxfield</a> (<span class="p-org org">Apple Inc.</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:grieger@google.com">Garret Rieger</a> (<span class="p-org org">Google Inc.</span>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2021 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>TODO(garretrieger)</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p> If you wish to make comments regarding this document, please <a href="https://github.com/w3c/PFE/issues/new">file an issue on the specification repository</a>. </p>
   <p> This document was produced by the <a href="https://www.w3.org/Fonts/WG/">Web Fonts Working Group</a> </p>
   <p> This document was produced by groups operating under
  the <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/">W3C Patent Policy</a>.
  W3C maintains a <a href="https://www.w3.org/2004/01/pp-impl/44556/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
  that page also includes instructions for disclosing a patent.
  An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/2020/Process-20200915/" id="w3c_process_revision">15 September 2020 W3C Process Document</a>. </p>
   <p></p>
   <p>initial draft is in progress.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#patch-incxfer"><span class="secno">2</span> <span class="content">Patch Based Incremental Transfer</span></a>
     <ol class="toc">
      <li>
       <a href="#patch-overview"><span class="secno">2.1</span> <span class="content">Overview</span></a>
       <ol class="toc">
        <li><a href="#font-subset"><span class="secno">2.1.1</span> <span class="content">Font Subset</span></a>
       </ol>
      <li>
       <a href="#data-types"><span class="secno">2.2</span> <span class="content">Data Types</span></a>
       <ol class="toc">
        <li><a href="#encoding"><span class="secno">2.2.1</span> <span class="content">Encoding</span></a>
        <li><a href="#primitives"><span class="secno">2.2.2</span> <span class="content">Primitives</span></a>
        <li><a href="#protocol-version"><span class="secno">2.2.3</span> <span class="content">ProtocolVersion</span></a>
        <li><a href="#sparsebitset"><span class="secno">2.2.4</span> <span class="content">SparseBitSet</span></a>
        <li>
         <a href="#compressedintlist"><span class="secno">2.2.5</span> <span class="content">CompressedIntList</span></a>
         <ol class="toc">
          <li><a href="#compressedintlist-deltas"><span class="secno">2.2.5.1</span> <span class="content">Delta Encoding</span></a>
          <li><a href="#compressedintlist-zigzag"><span class="secno">2.2.5.2</span> <span class="content">Zig-Zag Encoding</span></a>
          <li><a href="#compressedintlist-uintbase128"><span class="secno">2.2.5.3</span> <span class="content">UIntBase128 Encoding</span></a>
         </ol>
        <li><a href="#compressedsortedintlist"><span class="secno">2.2.6</span> <span class="content">CompressedSortedIntList</span></a>
        <li><a href="#rangelist"><span class="secno">2.2.7</span> <span class="content">RangeList</span></a>
        <li><a href="#AxisSpace"><span class="secno">2.2.8</span> <span class="content">AxisSpace</span></a>
        <li><a href="#objects"><span class="secno">2.2.9</span> <span class="content">Objects</span></a>
       </ol>
      <li>
       <a href="#schemas"><span class="secno">2.3</span> <span class="content">Object Schemas</span></a>
       <ol class="toc">
        <li><a href="#CompressedSet"><span class="secno">2.3.1</span> <span class="content">CompressedSet</span></a>
        <li><a href="#AxisInterval"><span class="secno">2.3.2</span> <span class="content">AxisInterval</span></a>
        <li><a href="#PatchRequest"><span class="secno">2.3.3</span> <span class="content">PatchRequest</span></a>
        <li><a href="#PatchResponse"><span class="secno">2.3.4</span> <span class="content">PatchResponse</span></a>
       </ol>
      <li>
       <a href="#client"><span class="secno">2.4</span> <span class="content">Client</span></a>
       <ol class="toc">
        <li><a href="#client-state"><span class="secno">2.4.1</span> <span class="content">Client State</span></a>
        <li><a href="#extend-subset"><span class="secno">2.4.2</span> <span class="content">Extending the Font Subset</span></a>
        <li><a href="#handling-patch-response"><span class="secno">2.4.3</span> <span class="content">Handling PatchResponse</span></a>
        <li><a href="#client-side-checksum-mismatch"><span class="secno">2.4.4</span> <span class="content">Client Side Checksum Mismatch</span></a>
       </ol>
      <li><a href="#handling-patch-request"><span class="secno">2.5</span> <span class="content">Server: Responding to a PatchRequest</span></a>
      <li><a href="#computing-checksums"><span class="secno">2.6</span> <span class="content">Computing Checksums</span></a>
      <li>
       <a href="#codepoint-reordering"><span class="secno">2.7</span> <span class="content">Codepoint Reordering</span></a>
       <ol class="toc">
        <li><a href="#reordering-checksum"><span class="secno">2.7.1</span> <span class="content">Codepoint Reordering Checksum</span></a>
       </ol>
      <li><a href="#patch-formats"><span class="secno">2.8</span> <span class="content">Patch Formats</span></a>
      <li><a href="#connection-speeds"><span class="secno">2.9</span> <span class="content">Connection Speeds</span></a>
     </ol>
    <li><a href="#range-request-incxfer"><span class="secno">3</span> <span class="content">Range Request Incremental Transfer</span></a>
    <li><a href="#negotiating-transfer-type"><span class="secno">4</span> <span class="content">Using Incremental Font Transfer in HTML</span></a>
    <li><a href="#priv-sec"><span class="secno"></span> <span class="content">Privacy and Security Considerations</span></a>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
      <li><a href="#conformance-classes"><span class="secno"></span> <span class="content">Conformance Classes</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>The success of WebFonts is unevenly distributed. This specification allows WebFonts to be used where
slow networks, very large fonts, or complex subsetting requirements currently preclude their use. For
example, even using WOFF 2 <a data-link-type="biblio" href="#biblio-woff2">[WOFF2]</a>, fonts for CJK languages are too large to be practical.</p>
   <p>See the Progressive Font Enrichment: Evaluation Report <a data-link-type="biblio" href="#biblio-pfe-report">[PFE-report]</a> for the investigation which led
to this specification.</p>
   <p>There are two different methods which can be used to incrementally transfer fonts. The first method,
Patch Subset, uses a backend server which can generate binary patches to an existing font. The second
method, Range Request, utilizes HTTP range requests to load only the parts of the original font that
are needed.</p>
   <p>The evaluation report found that patch subset was generally more efficient in terms of overall
performance and transferred bytes than range request. However, Range Request is simpler to deploy
for many uses cases while still providing material improvments to loading performance for large fonts
so it is included in this specification as an alternative method.</p>
   <h2 class="heading settled" data-level="2" id="patch-incxfer"><span class="secno">2. </span><span class="content">Patch Based Incremental Transfer</span><a class="self-link" href="#patch-incxfer"></a></h2>
   <h3 class="heading settled" data-level="2.1" id="patch-overview"><span class="secno">2.1. </span><span class="content">Overview</span><a class="self-link" href="#patch-overview"></a></h3>
   <p>In the patch subset approach to incremental font transfer a server generates binary patches which a
client applies to a subset of the font in order to extend the coverage of that font subset. The server
is stateless, it does not maintain any session data for clients between requests. Thus when a client
requests the generation of a patch from the server it must fully describe the current subset of the
font that it has in a way which allows the server to recreate it.</p>
   <p>Generic binary patch algorithms are used which do not need to be aware of the specifics of the font
format. Typically a server will produce a patch by generating two font subsets: one which matches what
the client currently has and one which matches the extended subset the client desires. A binary patch
is then produced between the two subsets.</p>
   <h4 class="heading settled" data-level="2.1.1" id="font-subset"><span class="secno">2.1.1. </span><span class="content">Font Subset</span><a class="self-link" href="#font-subset"></a></h4>
   <p>A subset of a font file is a modified version of the font that contains only the data needed to
render a subset of the codepoints in the original font. A subsetted font should be able to render
any combination of the codepoints in the subset identically to the original font.</p>
   <h3 class="heading settled" data-level="2.2" id="data-types"><span class="secno">2.2. </span><span class="content">Data Types</span><a class="self-link" href="#data-types"></a></h3>
   <p>This section lists all of the data types that are used to form the request and response messages
sent between the client and server.</p>
   <h4 class="heading settled" data-level="2.2.1" id="encoding"><span class="secno">2.2.1. </span><span class="content">Encoding</span><a class="self-link" href="#encoding"></a></h4>
   <p>All data types defined here are encoded into a byte representation for transport using CBOR
(Concise Binary Object Representation) <a data-link-type="biblio" href="#biblio-rfc8949">[rfc8949]</a>. More information on how each data types
should be encoded by CBOR are given in the definition of those data types.</p>
   <h4 class="heading settled" data-level="2.2.2" id="primitives"><span class="secno">2.2.2. </span><span class="content">Primitives</span><a class="self-link" href="#primitives"></a></h4>
   <table>
    <tbody>
     <tr>
      <th>Data Type
      <th>Description
      <th>CBOR Major Type
     <tr>
      <td>Integer
      <td>An integer value range [-2^64 - 1, 2^64 - 1] inclusive.
      <td>0 or 1
     <tr>
      <td>Float
      <td>IEEE 754 Single-Precision Float.
      <td>7
     <tr>
      <td>ByteString
      <td>Variable number of bytes.
      <td>2
     <tr>
      <td>ArrayOf&lt;Type>
      <td>Array of a variable number of items of Type.
      <td>4
   </table>
   <h4 class="heading settled" data-level="2.2.3" id="protocol-version"><span class="secno">2.2.3. </span><span class="content">ProtocolVersion</span><a class="self-link" href="#protocol-version"></a></h4>
   <p>An Integer describing the version of this communication protocol being used by a
PatchRequest or PatchResponse. This value guides the semantics and interpretation
of the fields sent.</p>
   <p>This field is for future expansion. There is only one valid value, 0.</p>
   <h4 class="heading settled" data-level="2.2.4" id="sparsebitset"><span class="secno">2.2.4. </span><span class="content">SparseBitSet</span><a class="self-link" href="#sparsebitset"></a></h4>
   <p>A data structure which compactly stores a set of distinct unsigned integers. The set is represented as
a tree where each node has a fixed number of children that recursively sub-divides an interval into
equal partitions. A tree of height <i>H</i> with branching factor <i>B</i> can store set membership
for integers in the interval [0 to <i>B</i><sup><i>H</i></sup>-1] inclusive. The tree is encoded into
a ByteString for transport.</p>
   <p>To construct the tree <i>T</i> which encodes set <i>S</i> first select the branching factor <i>B</i> (how many children each node has). <i>B</i> can be 4, 8, 16, or 32.</p>
   <p class="note" role="note"><span>Note:</span> the encoder can use any of the possible branching factors, but it is recommended to
use 4 as that has been shown to give the smallest encodings for most sets typically encountered.</p>
   <p>Next, determine the height, <i>H</i>, of the tree:</p>
   <p><i>H</i> = ceil(log<sub><i>B</i></sub>(max(S) + 1))</p>
   <p>Next create a tree of height H where all non-leaf nodes have <i>B</i> children. Each node in the tree
has a single value composed of <i>B</i> bits. Given a node <i>p</i> which has <i>B</i> children: <i>c<sub>0</sub></i> ... <i>c<sub><i>B</i> - 1</sub></i> and is in a tree, <i>T</i>, of height <i>H</i>, then:</p>
   <ul>
    <li data-md>
     <p>D(<i>n</i>) is depth of node <i>n</i>: the number of edges between
the root node and <i>n</i>.</p>
    <li data-md>
     <p>Start(<i>c<sub>i</sub></i>) is the start (inclusive) of the interval  covered by <i>c<sub>i</sub></i> :<br> Start(<i>c<sub>i</sub></i>) =
 Start(<i>p</i>) + <i>i</i> * <i>B</i><sup><i>H</i> - D(<i>c<sub>i</sub></i>)</sup></p>
    <li data-md>
     <p>End(<i>c<sub>i</sub></i>) is the end (exclusive) of the interval  covered by <i>c<sub>i</sub></i> :<br> End(<i>c<sub>i</sub></i>) =
 Start(<i>p</i>) + (<i>i</i> + 1) * <i>B</i><sup><i>H</i> - D(<i>c<sub>i</sub></i>)</sup></p>
    <li data-md>
     <p>Start(root node) = 0</p>
    <li data-md>
     <p>The value of node <i>p</i> is a string of <i>B</i> bits. If its bits are numbered from 0 (least
significant) to <i>B</i> - 1 (most significant) then bit <i>i</i> will be 1 if the set <i>S</i> contains at least one member in the interval [Start(<i>c<sub>i</sub></i>),
End(<i>c<sub>i</sub></i>)), otherwise bit <i>i</i> will be 0.</p>
    <li data-md>
     <p>If for node <i>p</i>, End(<i>p</i>) - Start(<i>p</i>) = <i>B</i>, then <i>p</i> will have no
children.</p>
   </ul>
   <p>The tree is encoded into a bit string. When appending multiple-bit values to the bit string, bits
are added in order from least significant bit to most significant bit.</p>
   <p>First append 2 bits which encode the branching factor:</p>
   <table>
    <tbody>
     <tr>
      <th>Bits 
      <th>Branching Factor
     <tr>
      <td>00
      <td>4
     <tr>
      <td>01
      <td>8
     <tr>
      <td>10
      <td>16
     <tr>
      <td>11
      <td>32
   </table>
   <p>Then append the value <i>H</i> - 1 as a 6 bit unsigned integer.</p>
   <p>Next the nodes are encoded into the bit string by traversing the nodes of the <i>T</i> in level
order and appending the value for each non-zero node to the bit string. If all of the set values
covered by a node’s interval are present within set <i>S</i>, then that node can instead be encoded
in the bit string as <i>B</i> bits all set to zero. All children of that node must not be encoded.</p>
   <p>Lastly the bit string is converted into a ByteString by converting each consecutive group of 8 bits
into the next byte of the string.
If the number of bits in the bit string is not a multiple of 8, zero bits are appended to the
next multiple of 8.
The bit with the smallest index in the bit string is the least
significant bit in the byte and the bit with the largest index is the most significant bit.</p>
   <div class="example" id="example-f5bb74e7">
    <a class="self-link" href="#example-f5bb74e7"></a> The set {2, 33, 323} in a tree with a branching factor of 8 is encoded as the bit string: 
<pre>  BitString:
  |- header |- lvl 0 |---- level 1 ----|------- level 2 -----------|
  |         |   n0   |   n1       n2   |   n3       n4       n5    |
  [ 10010000 10000100 10001000 10000000 00100000 01000000 00010000 ]

  Which then becomes the ByteString:
  [
    0b00001001,
    0b00100001,
    0b00010001,
    0b00000001,
    0b00000100,
    0b00000010,
    0b00001000
  ]
</pre>
    <p>First determine the height of the tree:</p>
    <p><i>H</i> = ceil(log<sub>8</sub>(323 + 1)) = 3</p>
    <p>Then append</p>
    <ul>
     <li data-md>
      <p>branching factor = 8 = 01</p>
     <li data-md>
      <p><i>H</i> - 1 = 2 = 000010</p>
    </ul>
    <p>Level 0:</p>
    <ul>
     <li data-md>
      <p>root node, n<sub>0</sub> append 00100001. Bit 0 is set because there are set members in the interval
 [0, 64), and bit 5 is set due to members in the interval [320, 384).</p>
    </ul>
    <p>Level 1:</p>
    <ul>
     <li data-md>
      <p>There will be two non-zero children corresponding to bit 0 and bit 5 in n<sub>0</sub>:</p>
     <li data-md>
      <p>n<sub>1</sub> append 00010001. It is child 0 of n<sub>0</sub> and subdivides the interval
 [0, 64). Bit 0 is set since there are set members in [0, 8) and bit 4 for [32, 40).</p>
     <li data-md>
      <p>n<sub>2</sub> append 00000001. It is child 5 of n<sub>0</sub> it subdivides the interval
 [320, 384). Bit 0 is set since there are set members in [320 - 328).</p>
    </ul>
    <p>Level 2:</p>
    <ul>
     <li data-md>
      <p>n<sub>3</sub> append 00000100. Child 0 of n<sub>1</sub>, bit 2 is set for the interval [2, 3) or 2.</p>
     <li data-md>
      <p>n<sub>4</sub> append 00000010. Child 4 of n<sub>1</sub>, bit 1 is set for the interval [33, 34) or 33.</p>
     <li data-md>
      <p>n<sub>5</sub> append 00001000. Child 0 of n<sub>2</sub>, bit 3 is set for the interval [323, 324)
 or 323.</p>
    </ul>
   </div>
   <div class="example" id="example-88b1de08">
    <a class="self-link" href="#example-88b1de08"></a> The set {0, 1, 2, ..., 17} can be encoded with a branching factor of 4 as: 
<pre>  BitString:
  |- header | l0 |- lvl 1 -| l2  |
  |         | n0 | n1 | n2 | n3  |
  [ 00010000 1100 0000 1000 1100 ]

  ByteString:
  [
    0b00001000,
    0b00000011,
    0b00110001
  ]
</pre>
    <p>First determine the height of the tree:</p>
    <p><i>H</i> = ceil(log<sub>4</sub>(17 + 1)) = 3</p>
    <p>Then append</p>
    <ul>
     <li data-md>
      <p>branching factor = 4 = 00</p>
     <li data-md>
      <p><i>H</i> - 1 = 2 = 000010</p>
    </ul>
    <p>Level 0:</p>
    <ul>
     <li data-md>
      <p>n<sub>0</sub> append 0011. Bit 0 set for [0, 16), bit 1 set for [16, 32)</p>
    </ul>
    <p>Level 1:</p>
    <ul>
     <li data-md>
      <p>n<sub>1</sub> append 0000. All bits zero to indicate interval [0, 16) is fully filled.</p>
     <li data-md>
      <p>n<sub>2</sub> append 0001. Bit 0 set for [16, 20)</p>
    </ul>
    <p>Level 2:</p>
    <ul>
     <li data-md>
      <p>n<sub>3</sub> append 0011. Bit 0 set for value 16, bit 1 set for value 17.</p>
    </ul>
   </div>
   <h4 class="heading settled" data-level="2.2.5" id="compressedintlist"><span class="secno">2.2.5. </span><span class="content">CompressedIntList</span><a class="self-link" href="#compressedintlist"></a></h4>
   <p>A data structure which compactly represents a list of integers.
The list is encoded into a ByteString for transport.</p>
   <p>There are three steps of encoding/compression: first delta, second zig-zag, and finally uintbase128.</p>
   <p>The final ByteString result is simply the concatenation of the individual uintbase128
encoded bytes.</p>
   <h5 class="heading settled" data-level="2.2.5.1" id="compressedintlist-deltas"><span class="secno">2.2.5.1. </span><span class="content">Delta Encoding</span><a class="self-link" href="#compressedintlist-deltas"></a></h5>
    Delta encoding converts a list of integers to a list of deltas between them. 
   <p>A list L of n integers L<sub>i<sub>0..n-1</sub></sub> is converted into a list
of N integers D<sub>i<sub>0..n-1</sub></sub> as follows:</p>
   <ul>
    <li data-md>
     <p>D<sub>0</sub> = L<sub>0</sub></p>
    <li data-md>
     <p>D<sub>i = 1..n-1</sub> = L<sub>i</sub> - L<sub>i-1<sub></sub></sub></p>
   </ul>
   <p>This has the effect of reducing the magnitude of the values, which reduces the number
of bytes required in the uintbase128 encoding, below.</p>
   <div class="example" id="example-a8b975f3">
    <a class="self-link" href="#example-a8b975f3"></a> 
<pre>// Note: unsorted
int_list = [23, 43, 12, 3, 67, 68, 69, 0]
delta_list = [23, 20, -31, -9, 64, 1, 1, -69]
</pre>
   </div>
   <h5 class="heading settled" data-level="2.2.5.2" id="compressedintlist-zigzag"><span class="secno">2.2.5.2. </span><span class="content">Zig-Zag Encoding</span><a class="self-link" href="#compressedintlist-zigzag"></a></h5>
   <p>Zig-Zag encoding reversibly converts signed integers to unsigned integers,
using the same number of bits. The entire range of values is supported.
This is required, as the <a href="#compressedintlist-uintbase128">§ 2.2.5.3 UIntBase128 Encoding</a> step works on
unsigned ints only.</p>
   <p>Zig-Zag encoding doubles the magnitude of the numbers, which cuts in
half the range of input values that can, for example, be encoded in 1 byte in
the uintbase128 encoding.</p>
   <div class="example" id="example-16a15e38">
    <a class="self-link" href="#example-16a15e38"></a> 
    <table>
     <tbody>
      <tr>
       <th>Value
       <th>Zig-Zag Encoding
      <tr>
       <td>0
       <td>0
      <tr>
       <td>1
       <td>2
      <tr>
       <td>2
       <td>4
      <tr>
       <td>3
       <td>6
      <tr>
       <td>4
       <td>8
      <tr>
       <td>-1
       <td>1
      <tr>
       <td>-2
       <td>3
      <tr>
       <td>-3
       <td>5
      <tr>
       <td>-4
       <td>7
    </table>
   </div>
   <p>Psuedo code:</p>
   <figure>
<pre>encode(n) {
  if (n >= 0)
    return n * 2
  else
    return (n * -2) - 1
}

decode(n) {
  if (n &amp; 1)
    return -((n + 1) / 2)
  else
    return n / 2
}
</pre>
    <div class="example" id="example-d75ff9a8">
<pre>delta_list = [23, 20, -31, -9, 64, 1, 1, -69]
zig_zag_encoded_list = [46, 40, 61, 17, 128, 2, 2, 137]
</pre>
    </div>
    <figcaption>Psuedo-code for Zig-Zag encoding and decoding</figcaption>
   </figure>
   <div class="example" id="example-ca161576">
    <a class="self-link" href="#example-ca161576"></a> 
<pre>zig_zag_encoded_list = [46, 40, 61, 17, 128, 2, 2, 137]
bytes = [2E 28 3D 11 80 01 02 02 89 01]
//       └┘ └┘ └┘ └┘ └───┘ └┘ └┘ └───┘
</pre>
   </div>
   <p>*TODO: Add reference to proto implementation*</p>
   <h5 class="heading settled" data-level="2.2.5.3" id="compressedintlist-uintbase128"><span class="secno">2.2.5.3. </span><span class="content">UIntBase128 Encoding</span><a class="self-link" href="#compressedintlist-uintbase128"></a></h5>
   <p>UIntBase128 is a different variable length encoding of unsigned integers,
suitable for values up to 2<sup>32</sup>-1. A UIntBase128 encoded number
is a sequence of bytes for which the most significant bit is set for all but
the last byte, and clear for the last byte. The number itself is base 128
encoded in the lower 7 bits of each byte. Thus, a decoding procedure for
a UIntBase128 is: start with value = 0. Consume a byte, setting value =
old value times 128 + (byte bitwise-and 127). Repeat last step until
the most significant bit of byte is false.</p>
   <p>UIntBase128 encoding format allows a possibility of sub-optimal encoding, where e.g.
the same numerical value can be represented with variable number of bytes (utilizing
leading zeros). For example, the value 63 could be encoded as either one byte 0x3F
or two (or more) bytes: [0x80, 0x3f]. An encoder must not allow this to happen and
*MUST* produce shortest possible encoding. A decoder *MUST* reject the font file
if it encounters a UIntBase128-encoded value with
leading zeros (a value that starts with the byte 0x80), if UIntBase128-encoded
sequence is longer than 5 bytes, or if a UIntBase128-encoded value exceeds
2<sup>32</sup>-1.</p>
   <div class="example" id="example-38105e7c">
    <a class="self-link" href="#example-38105e7c"></a> 
<pre>bool ReadUIntBase128( data, *result ) {
    UInt32 accum = 0;

    for (i = 0; i &lt; 5; i++) {
        UInt8 data_byte = data.getNextUInt8();

        // No leading 0’s
        if (i == 0 &amp;&amp; data_byte == 0x80) return false;if (i == 0 &amp;&amp; data_byte = 0x80) return false;

        // If any of top 7 bits are set then &lt;&lt; 7 would overflow
        if (accum &amp; 0xFE000000) return false;

        *accum = (accum &lt;&lt; 7) | (data_byte &amp; 0x7F);

        // Spin until most significant bit of data byte is false
        if ((data_byte &amp; 0x80) == 0) {
            *result = accum;
            return true;
        }
    }
    // UIntBase128 sequence exceeds 5 bytes
    return false;
}
</pre>
   </div>
   <div class="example" id="example-96daa8f6">
    <a class="self-link" href="#example-96daa8f6"></a> 
<pre>Value       Value (binary)                     Output Bytes
0           00000000000000000000000000000000   00000000
1           00000000000000000000000000000001   00000001
2           00000000000000000000000000000010   00000010
3           00000000000000000000000000000011   00000011
127         00000000000000000000000001111111   01111111
128         00000000000000000000000010000000   10000000 00000001
255         00000000000000000000000011111111   11111111 00000001
16256       00000000000000000011111110000000   10000000 01111111
2080768     00000000000111111100000000000000   10000000 10000000 01111111
266338304   00001111111000000000000000000000   10000000 10000000 10000000 01111111
4294967295  11111111111111111111111111111111   11111111 11111111 11111111 11111111 00001111
</pre>
   </div>
   <h4 class="heading settled" data-level="2.2.6" id="compressedsortedintlist"><span class="secno">2.2.6. </span><span class="content">CompressedSortedIntList</span><a class="self-link" href="#compressedsortedintlist"></a></h4>
   <p>A data structure which compactly represents a sorted list of non-negative integers.
The list is encoded into a ByteString for transport.</p>
   <p>This is a variation on CompressedIntList with better compression.
Sorted lists only use two steps of encoding/compression: first deltas and then
UIntBase128.
The <a href="#compressedintlist-zigzag">§ 2.2.5.2 Zig-Zag Encoding</a> step is skipped.
This allows twice the range in UIntBase128, so that single bytes may be used more often.</p>
   <h4 class="heading settled" data-level="2.2.7" id="rangelist"><span class="secno">2.2.7. </span><span class="content">RangeList</span><a class="self-link" href="#rangelist"></a></h4>
   <p>A RangeList encodes a set of unsigned 32 bit integers. The set is encoded as a
list of disjoint intervals. Each interval is represented by two integers, a
start (inclusive) and end (inclusive).</p>
   <p>A RangeList is a list of n pairs
[min<sub>i<sub>0..n-1</sub></sub>, max<sub>i<sub>0..n-1</sub></sub>].
The list must be non-decreasing, i.e. min<sub>i=1..n-1</sub> >= max<sub>i-1<sub>.</sub></sub></p>
   <p>To encode this list, we convert it to a list L of 2n integers, where
L<sub>2i</sub> = min<sub>i</sub> and L<sub>2i+1</sub> = max<sub>i</sub> for
i = 0..n-1.</p>
   <p>L is a sorted list, so <a href="#compressedsortedintlist">§ 2.2.6 CompressedSortedIntList</a> is used to encode it as a ByteString.</p>
   <div class="example" id="example-ce67a84d">
    <a class="self-link" href="#example-ce67a84d"></a> 
<pre>RangeList = [3, 10], [13, 268]
int list = [3, 10, 13, 268]
delta list = [3, 7, 3, 255]
// Sorted, so no Zig-Zag encoding.
CompressedIntList (sorted) = [0x03 0x07 0x03 0xFF 0x01]
</pre>
   </div>
   <h4 class="heading settled" data-level="2.2.8" id="AxisSpace"><span class="secno">2.2.8. </span><span class="content">AxisSpace</span><a class="self-link" href="#AxisSpace"></a></h4>
   <p>Stores a set of intervals on one or more open type variation axes <a data-link-type="biblio" href="#biblio-opentype-variations">[opentype-variations]</a>.
Encoded as a CBOR map (major type 5). The key in each pair is an <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/fvar#variationaxisrecord"> axis tag</a>. It is encoded as a ByteString containing exactly 4 ASCII characters. The value in each
pair is an <a href="#AxisInterval"><code>AxisInterval</code></a>.</p>
   <h4 class="heading settled" data-level="2.2.9" id="objects"><span class="secno">2.2.9. </span><span class="content">Objects</span><a class="self-link" href="#objects"></a></h4>
   <p>Objects are data structures comprised of key and value pairs. Objects are encoded via CBOR as maps
(major type 5). Each key and value pair is encoded as a single map entry. Keys are always unsigned
integers and are encoded using major type 0. Values are encoded using the encoding specified by the
type of the value.</p>
   <p>All fields in an object are optional and do not need to have an associated value. Conversely when
decoding and object fields may be present which are not specified in the schema. The decoder must
ignore without error any key and value pairs where the key is not recognized.</p>
   <p>There are several types of object used, each type is defined by a schema in <a href="#schemas">§ 2.3 Object Schemas</a>. The schema
for a type specifies for each field:</p>
   <ul>
    <li data-md>
     <p>A human readable name for the field. For reference only, not used in the encoding.</p>
    <li data-md>
     <p>A unsigned integer id for the field. This is used as the key in the encoding.</p>
    <li data-md>
     <p>The type of the value stored in this field. Can be any of the types defined in <a href="#data-types">§ 2.2 Data Types</a> including object types.</p>
   </ul>
   <h3 class="heading settled" data-level="2.3" id="schemas"><span class="secno">2.3. </span><span class="content">Object Schemas</span><a class="self-link" href="#schemas"></a></h3>
   <h4 class="heading settled" data-level="2.3.1" id="CompressedSet"><span class="secno">2.3.1. </span><span class="content">CompressedSet</span><a class="self-link" href="#CompressedSet"></a></h4>
   <p>Encodes a set of unsigned integers. The set is not ordered and does not
allow duplicates. Members of the set are encoded into either a SparseBitSet or a
RangeList. To obtain the final set the members of the sparse
bit set and the list of ranges are unioned together.</p>
   <table>
    <tbody>
     <tr>
      <th>ID 
      <th>Field Name
      <th>Type
     <tr>
      <td>0
      <td>sparse_bit_set
      <td>SparseBitSet (ByteString)
     <tr>
      <td>1
      <td>range_deltas
      <td>RangeList (ByteString)
   </table>
   <h4 class="heading settled" data-level="2.3.2" id="AxisInterval"><span class="secno">2.3.2. </span><span class="content">AxisInterval</span><a class="self-link" href="#AxisInterval"></a></h4>
   <table>
    <tbody>
     <tr>
      <th>ID
      <th>Field Name
      <th>Value Type
     <tr>
      <td>0
      <td>start
      <td>Float
     <tr>
      <td>1
      <td>end
      <td>Float
   </table>
   <p><code>AxisInterval</code> defines an interval (from <code>start</code> to <code>end</code>) on some
variable axis in a font.</p>
   <p>For an <code>AxisInterval</code> object to be well formed:</p>
   <ul>
    <li data-md>
     <p><code>start</code> must be set.</p>
    <li data-md>
     <p><code>end</code> is optional, must be greater than <code>start</code>. If <code>end</code> is not set
then this interval is a single point, <code>start</code>.</p>
   </ul>
   <h4 class="heading settled" data-level="2.3.3" id="PatchRequest"><span class="secno">2.3.3. </span><span class="content">PatchRequest</span><a class="self-link" href="#PatchRequest"></a></h4>
   <table>
    <tbody>
     <tr>
      <th>ID
      <th>Field Name
      <th>Value Type
     <tr>
      <td>0
      <td>protocol_version
      <td>ProtocolVersion (Integer)
     <tr>
      <td>1
      <td>accept_patch_format
      <td>CompressedIntList (ByteString)
     <tr>
      <td>2
      <td>codepoints_have
      <td>CompressedSet
     <tr>
      <td>3
      <td>codepoints_needed
      <td>CompressedSet
     <tr>
      <td>4
      <td>indices_have
      <td>CompressedSet
     <tr>
      <td>5
      <td>indices_needed
      <td>CompressedSet
     <tr>
      <td>6
      <td>axis_space_have
      <td>AxisSpace
     <tr>
      <td>7
      <td>axis_space_needed
      <td>AxisSpace
     <tr>
      <td>8
      <td>ordering_checksum
      <td>Integer
     <tr>
      <td>9
      <td>original_font_checksum
      <td>Integer
     <tr>
      <td>10
      <td>base_checksum
      <td>Integer
     <tr>
      <td>11
      <td>connection_speed
      <td>Integer
   </table>
   <p>For a PatchRequest object to be well formed:</p>
   <ul>
    <li data-md>
     <p><code>protocol_version</code> must be set to 0.</p>
    <li data-md>
     <p><code>accept_patch_format</code> can include any of the values listed in <a href="#patch-formats">§ 2.8 Patch Formats</a>.</p>
    <li data-md>
     <p>If either of <code>indices_have</code> or <code>indices_needed</code> is set to a non-empty set
then <code>ordering_checksum</code> must be set.</p>
    <li data-md>
     <p>If <code>codepoints_have</code> or <code>indices_have</code> is set to a non-empty set then <code>original_font_checksum</code> and <code>base_checksum</code> must be set.</p>
    <li data-md>
     <p><code>connection_speed</code> can be any of the values listed in <a href="#connection-speeds">§ 2.9 Connection Speeds</a>.</p>
   </ul>
   <h4 class="heading settled" data-level="2.3.4" id="PatchResponse"><span class="secno">2.3.4. </span><span class="content">PatchResponse</span><a class="self-link" href="#PatchResponse"></a></h4>
   <table>
    <tbody>
     <tr>
      <th>ID
      <th>Field Name
      <th>Value Type
     <tr>
      <td>0
      <td>protocol_version
      <td>ProtocolVersion (Integer)
     <tr>
      <td>1
      <td>patch_format
      <td>Integer
     <tr>
      <td>2
      <td>patch
      <td>ByteString
     <tr>
      <td>3
      <td>replacement
      <td>ByteString
     <tr>
      <td>4
      <td>original_font_checksum
      <td>Integer
     <tr>
      <td>5
      <td>patched_checksum
      <td>Integer
     <tr>
      <td>6
      <td>codepoint_ordering
      <td>CompressedIntList
     <tr>
      <td>7
      <td>ordering_checksum
      <td>Integer
     <tr>
      <td>8
      <td>subset_axis_space
      <td>ArrayOf&lt;AxisInterval>
     <tr>
      <td>9
      <td>original_axis_space
      <td>ArrayOf&lt;AxisInterval>
   </table>
   <p>For a PatchResponse object to be well formed:</p>
   <ul>
    <li data-md>
     <p><code>protocol_version</code> must be set to 0.</p>
    <li data-md>
     <p><code>patch_format</code> can be any of the values listed <a href="#patch-formats">§ 2.8 Patch Formats</a></p>
    <li data-md>
     <p>Only one of <code>patch</code> or <code>replacement</code> may be set.</p>
    <li data-md>
     <p>If either <code>patch</code> or <code>replacement</code> is set then <code>patch_format</code>, <code>patched_checksum</code>, and <code>original_font_checksum</code> must be set.</p>
    <li data-md>
     <p>If <code>codepoint_ordering</code> is set then <code>ordering_checksum</code> must be set.</p>
   </ul>
   <h3 class="heading settled" data-level="2.4" id="client"><span class="secno">2.4. </span><span class="content">Client</span><a class="self-link" href="#client"></a></h3>
   <h4 class="heading settled" data-level="2.4.1" id="client-state"><span class="secno">2.4.1. </span><span class="content">Client State</span><a class="self-link" href="#client-state"></a></h4>
   <p>The client will need to maintain at minimum the following state for each font file being incrementally
transferred:</p>
   <ul>
    <li data-md>
     <p>Font subset: a byte array containing the binary data for the most recent version of the subset of
the font being incrementally transferred. For a new font this is initialized to empty byte array.</p>
    <li data-md>
     <p>Original font checksum: the most recent value of <a href="#PatchResponse"><code>PatchResponse.original_font_checksum</code></a> received
from the server for this font.</p>
    <li data-md>
     <p>Codepoint Reordering Map: The most recent <a href="#codepoint-reordering">§ 2.7 Codepoint Reordering</a> received from the server
for this font.</p>
    <li data-md>
     <p>Codepoint Reordering Checksum: The most recent <a href="#PatchResponse"><code>PatchResponse.ordering_checksum</code></a> for this font.</p>
    <li data-md>
     <p>Original Font Axis Space: the variations axis space that the original font covers. Supplied
by <a href="#PatchResponse"><code>PatchResponse.original_axis_space</code></a>.</p>
    <li data-md>
     <p>Subset Axis Space: the most recent variations axis space that the subsetted font covers. Supplied by <a href="#PatchResponse"><code>PatchResponse.subset_axis_space</code></a>.</p>
   </ul>
   <h4 class="heading settled" data-level="2.4.2" id="extend-subset"><span class="secno">2.4.2. </span><span class="content">Extending the Font Subset</span><a class="self-link" href="#extend-subset"></a></h4>
   <p>A client extends its font subset to cover additional codepoints by making HTTP requests to
a Patch Subset server. The HTTP request must use either the GET or POST method:</p>
   <ul>
    <li data-md>
     <p>If sent as a POST request the post body will be a single <a href="#PatchRequest"><code>PatchRequest</code></a> object encoded via CBOR.</p>
    <li data-md>
     <p>If sent as a GET request the client will include a single query parameter, <code>request</code>:<br> the value is a single <a href="#PatchRequest"><code>PatchRequest</code></a> object encoded via CBOR and then base64url
encoding <a data-link-type="biblio" href="#biblio-rfc4648">[rfc4648]</a>.</p>
   </ul>
   <p>For both POST and GET requests the path of the request identifies the specific font. All requests
must be made over HTTPS.</p>
   <p>The fields of the <a href="#PatchRequest"><code>PatchRequest</code></a> object should be set
as follows:</p>
   <ul>
    <li data-md>
     <p><code>protocol_version</code>: set to 0.</p>
    <li data-md>
     <p><code>accept_patch_format</code>: set to the list of <a href="#patch-formats">§ 2.8 Patch Formats</a> that this client is
capable of decoding. Must contain at least one format.</p>
    <li data-md>
     <p><code>codepoints_have</code>: set to exactly the set of codepoints that the current font subset
contains data for. If the current font subset is an empty byte array this field is left unset.
If the client has a codepoint ordering for this font then this field should not be set.</p>
    <li data-md>
     <p><code>codepoints_needed</code>: set to the set of codepoints that the client wants to
add to its font subset. If the client has a codepoint ordering for this font then this
field should not be set.</p>
    <li data-md>
     <p><code>indices_have</code>: encodes the set of additional codepoints that the current
font subset contains data for. The codepoint values are transformed to indices by applying <a href="#codepoint-reordering">§ 2.7 Codepoint Reordering</a> to each codepoint value. If the client does not have a codepoint
ordering for this font then this field should not be set.</p>
    <li data-md>
     <p><code>indices_needed</code>: encodes the set of codepoints that the client wants to add to its
font subset. The codepoint values are transformed to indices by applying <a href="#codepoint-reordering">§ 2.7 Codepoint Reordering</a> to each codepoint value. If the client does not have a codepoint
ordering for this font then this field should not be set.</p>
    <li data-md>
     <p><code>axis_space_have</code>: set to the current value of <code>subset_axis_space</code> saved in the state for this font.</p>
    <li data-md>
     <p><code>axis_space_needed</code>: set to the intervals of each variable axis in the original
font that the client wants to add to its font subset. If the client wants an entire axis
from the original font then that axis should not be listed.</p>
    <li data-md>
     <p><code>ordering_checksum</code>: If either of <code>indices_have</code> or <code>indices_needed</code> is set then this must be set to the current value of <code>ordering_checksum</code> saved in the state for this font.</p>
    <li data-md>
     <p><code>original_font_checksum</code>:
Set to saved value for <code>original_font_checksum</code> in the state for this font. If
there is no saved value leave this field unset.</p>
    <li data-md>
     <p><code>base_checksum</code>:
Set to the checksum of the font subset byte array saved in the state for this font. See: <a href="#computing-checksums">§ 2.6 Computing Checksums</a>.</p>
    <li data-md>
     <p><code>connection_speed</code>:
Can be optionally set by the client to a value from <a href="#connection-speeds">§ 2.9 Connection Speeds</a> by finding the value
that corresponds to the client’s average round trip time.</p>
   </ul>
   <h4 class="heading settled" data-level="2.4.3" id="handling-patch-response"><span class="secno">2.4.3. </span><span class="content">Handling PatchResponse</span><a class="self-link" href="#handling-patch-response"></a></h4>
   <p>If a server is able to successfully process a <a href="#PatchRequest"><code>PatchRequest</code></a> if will respond with HTTP status code 200 and the body of the response will be a <a href="#PatchResponse"><code>PatchResponse</code></a> object encoded via CBOR.
The client should interpret and process the fields of the object as follows:</p>
   <ol>
    <li data-md>
     <p>If field <code>replacement</code> is set then: the byte array in this field is a binary patch
 in the format specified by <code>patch_format</code>. Apply the binary patch to a base which
 is an empty byte array. Replace the saved font subset with the result of the patch application.</p>
    <li data-md>
     <p>If field <code>patch</code> is set then:  the byte array in this field is a binary patch
in the format specified by <code>patch_format</code>. Apply the binary patch to the saved font
subset. Replace the saved font subset with the result of the patch application.</p>
    <li data-md>
     <p>If either <code>replacement</code> or <code>patch</code> is set then: <a href="#computing-checksums">compute the checksum</a> of the font subset produced by the patch
application in steps 1 or 2. If the computed checksum is not equal to <code>patched_checksum</code> this is a recoverable error. Follow the procedure in <a href="#client-side-checksum-mismatch">§ 2.4.4 Client Side Checksum Mismatch</a>. Otherwise
update the saved original font checksum with the value in <code>original_font_checksum</code>.</p>
    <li data-md>
     <p>If fields <code>codepoint_ordering</code> and <code>ordering_checksum</code> are set then update
the saved codepoint ordering and checksum with the new values specified by these two fields.
If neither <code>replacement</code> nor <code>patch</code> are set, then the client should
resend the request that triggered this response but use the new codepoint ordering provided in
this response.</p>
    <li data-md>
     <p>If <code>original_axis_space</code> is set then update the saved original axis space with the value
specified in this field.</p>
    <li data-md>
     <p>If <code>subset_axis_space</code> is set then update the saved subset axis space with the value
specified in this field.</p>
   </ol>
   <h4 class="heading settled" data-level="2.4.4" id="client-side-checksum-mismatch"><span class="secno">2.4.4. </span><span class="content">Client Side Checksum Mismatch</span><a class="self-link" href="#client-side-checksum-mismatch"></a></h4>
   <p>If the the checksum of the font subset computed by the client does not match the <code>patched_checksum</code> in the server’s response then the client should:</p>
   <ol>
    <li data-md>
     <p>Discard all currently saved state for this font.</p>
    <li data-md>
     <p><a href="#extend-subset">Resend the request</a>. Set the <code>codepoints_needed</code> field
to the union of the codepoints in the discarded font subset and the set of code points
the the previous request was trying to add.</p>
   </ol>
   <h3 class="heading settled" data-level="2.5" id="handling-patch-request"><span class="secno">2.5. </span><span class="content">Server: Responding to a PatchRequest</span><a class="self-link" href="#handling-patch-request"></a></h3>
   <p>If the server receives a well formed <a href="#PatchRequest"><code>PatchRequest</code></a> over
HTTPS that was populated according to the requirements in <a href="#extend-subset">§ 2.4.2 Extending the Font Subset</a> then it should
respond with HTTP status code 200. The body of the response should be a single <a href="#PatchRequest"><code>PatchResponse</code></a> object encoded via CBOR.</p>
   <p>The path in the request identifies the specific font that a patch is desired for. From the request
object the server can produce two codepoint sets:</p>
   <ol>
    <li data-md>
     <p>Codepoints the client has: formed by the union of the codepoint sets specified by <code>codepoints_have</code> and <code>indices_have</code>. The indices in <code>indices_have</code> must be mapped to codepoints by the application of the
 codepoint reordering with a checksum matching <code>ordering_checksum</code>.</p>
    <li data-md>
     <p>Codepoints the client needs: formed by the union of the codepoint sets specified by <code>codepoints_needed</code> and <code>indices_needed</code>. The indices in <code>indices_needed</code> must be mapped to codepoints by the application of the
 codepoint reordering with a checksum matching <code>ordering_checksum</code>.</p>
   </ol>
   <p>Likewise, the server can produce two variable axis spaces:</p>
   <ol>
    <li data-md>
     <p>Axis space the client has: provided by <code>axis_space_have</code>. If any axes in the font are
 not specified in <code>axis_space_have</code> then for those axes add their entire interval
 from the original font.</p>
    <li data-md>
     <p>Axis space the client needs: provided by <code>axis_space_needed</code>. If any axes in the font are
 not specified in <code>axis_space_needed</code> then for those axes add their entire interval
 from the original font.</p>
   </ol>
   <p>If the server does not recognize the codepoint ordering used by the client, it must respond
with a response that will cause the client to update it’s codepoint ordering to one the server
will recognize via the process described in <a href="#handling-patch-response">§ 2.4.3 Handling PatchResponse</a> and not include any patch.
That is the <code>patch</code> and <code>replacement</code> fields must not be set.</p>
   <p>Otherwise when the response is applied by the client following the process in <a href="#handling-patch-response">§ 2.4.3 Handling PatchResponse</a> to a font subset with checksum <code>base_checksum</code> it must result
in an extended font subset:</p>
   <ul>
    <li data-md>
     <p>That contains data for at least the union of the set of codepoints needed and the sets of
codepoints the client already has.</p>
    <li data-md>
     <p>That contains a variation axis space that covers at least the union of the axis space the client
has and the axis space the client needs.</p>
   </ul>
   <p>Additionally:</p>
   <ul>
    <li data-md>
     <p>The format of the patch in the either the <code>patch</code> or <code>replace</code> fields must be
one of those listed in <code>accept_patch_format</code>.</p>
    <li data-md>
     <p>The value of <code>original_font_checksum</code> must be set to the checksum of the original font.
The checksum value must computed by the procedure in <a href="#computing-checksums">§ 2.6 Computing Checksums</a>.</p>
    <li data-md>
     <p>If the set of codepoints the client has is empty the response must set the <code>codepoint_ordering</code> and <code>ordering_checksum</code> fields following <a href="#codepoint-reordering">§ 2.7 Codepoint Reordering</a>.</p>
    <li data-md>
     <p>If the set of codepoints the client has is empty and the original font has variation axes, the
response must set the <code>original_axis_space</code> fields to the axis space covered by
the original font.</p>
    <li data-md>
     <p>If <code>patch</code> or <code>replacement</code> fields are set and the original font has
variation axes, the response must set the <code>subset_axis_space</code> field to the axis space
covered by the font subset.</p>
    <li data-md>
     <p>If <code>accept_patch_format</code> contains any unrecognized patch formats the server should
ignore the unrecognized ones. Likewise if <code>connection_speed</code> contains any unrecognized
connection speeds the server should ignore the unrecognized ones.</p>
   </ul>
   <p class="note" role="note"><span>Note:</span> the server can optionally use the client’s provided connection speed to inform how many extra
codepoints should be sent. For example on slower connections it may be more performant to send extra
codepoints if they can prevent a future request from needing to be sent.</p>
   <p class="note" role="note"><span>Note:</span> the server can respond with either a patch or a replacement but should try to produce a patch
where possible. Replacement’s should only be used in situations where the server is unable to recreate
the client’s state in order to generate a patch against it.</p>
   <p>Possible error responses:</p>
   <ul>
    <li data-md>
     <p>If the request is malformed the server may instead respond with http status code 400 to indicate an
error.</p>
    <li data-md>
     <p>If the requested font is not recognized by the server it may respond with http status code 404 to
indicate a not found error.</p>
   </ul>
   <h3 class="heading settled" data-level="2.6" id="computing-checksums"><span class="secno">2.6. </span><span class="content">Computing Checksums</span><a class="self-link" href="#computing-checksums"></a></h3>
   <p>64 bit checksums of byte strings are computed using the <a href="https://github.com/ztanml/fast-hash">fast hash</a> algorithm. A python like pseudo
code version of the algorithm is presented below:</p>
<pre># Constant values come fast hash: https://github.com/ztanml/fast-hash
SEED = 0x11743e80f437ffe6
M = 0x880355f21e6d1965

mix(value):
  value = value ^ (value >> 23)
  value = value * 0x2127599bf4325c37
  value = value ^ (value >> 47)
  return value

fast_hash(byte[] data):
  # When casting byte arrays into unsigned 64 bit integers the bytes are in little
  # endian order. That is the smallest index is the least significant byte.
  uint64 hash = SEED ^ (length(data) * M)
  for (i = 0; i &lt;= length(bytes) - 8; i += 8)
    hash = (hash ^ mix((uint64) data[i:i+8])) * M

  remaining = length(data) % 8
  if not remaining:
    return mix(hash)

  uint64 last_value = (uint64) concat(data[length(data) - remaining:],
                                      [0] * (8 - remaining))
  return mix((hash ^ mix(last_value)) * M)
</pre>
   <p class="note" role="note"><span>Note:</span> a C implementation of fast hash can be found <a href="https://github.com/ztanml/fast-hash">here</a>.</p>
   <h3 class="heading settled" data-level="2.7" id="codepoint-reordering"><span class="secno">2.7. </span><span class="content">Codepoint Reordering</span><a class="self-link" href="#codepoint-reordering"></a></h3>
   <p>A codepoint reordering for a font defines a function which maps unicode codepoint values from the
font to a continuous space of [0, number of codepoints in the font). This transformation is intended
to reduce the cost of representing codepoint sets.</p>
   <p>A codepoint ordering is encoded into a <code>CompressedList</code>. The list must contain all unicode
codepoints that are supported by the font. The index of a particular unicode codepoint in the list is
the new value for that codepoint.</p>
   <p>A server is free to choose any codepoint ordering, but should try to pick one that will minimize the
size of encoded codepoint sets for that font.</p>
   <h4 class="heading settled" data-level="2.7.1" id="reordering-checksum"><span class="secno">2.7.1. </span><span class="content">Codepoint Reordering Checksum</span><a class="self-link" href="#reordering-checksum"></a></h4>
   <p>A checksum of a codepoint reordering can be computed as follows:</p>
<pre>SEED = 0x11743e80f437ffe6
M = 0x880355f21e6d1965

mix(value):
  value = value ^ (value >> 23)
  value = value * 0x2127599bf4325c37
  value = value ^ (value >> 47)
  return value

fast_hash_ordering(uint64[] ordering):
  uint64 hash = SEED ^ (length(ordering) * 8 * M)
  for (i = 0; i &lt; length(ordering); i++)
    # to ensure checksums are consistent across all platforms, the integers must be in little
    # endian order.
    hash = (hash ^ mix(little_endian (ordering[i])) * M

  return mix(hash)
</pre>
   <h3 class="heading settled" data-level="2.8" id="patch-formats"><span class="secno">2.8. </span><span class="content">Patch Formats</span><a class="self-link" href="#patch-formats"></a></h3>
   <p>The following patch formats may be used by the server to create binary diffs between a source file
and a target file:</p>
   <table>
    <tbody>
     <tr>
      <th>Format
      <th>Value
      <th>Notes
     <tr>
      <td>VCDIFF
      <td>0
      <td>Uses VCDIFF format <a data-link-type="biblio" href="#biblio-rfc3284">[rfc3284]</a> to produce the patch. All client and server implementations
    must support this format.
     <tr>
      <td>Brotli Shared Dictionary
      <td>1
      <td>Uses brotli compression <a data-link-type="biblio" href="#biblio-rfc7932">[rfc7932]</a> to produce the patch. The source file is used as a shared
    dictionary <a data-link-type="biblio" href="#biblio-shared-brotli">[Shared-Brotli]</a> given to the brotli compressor and decompressor.
   </table>
   <h3 class="heading settled" data-level="2.9" id="connection-speeds"><span class="secno">2.9. </span><span class="content">Connection Speeds</span><a class="self-link" href="#connection-speeds"></a></h3>
   <p>The following connection speed values can be used:</p>
   <table>
    <tbody>
     <tr>
      <th>Name
      <th>Value
      <th>Round Trip Times
     <tr>
      <td>Very Slow
      <td>0
      <td>> 1000 ms.
     <tr>
      <td>Slow
      <td>1
      <td>[300 ms, 1000 ms)
     <tr>
      <td>Average
      <td>2
      <td>[150 ms, 300 ms)
     <tr>
      <td>Fast
      <td>3
      <td>[80 ms, 150 ms)
     <tr>
      <td>Very Fast
      <td>4
      <td>[20 ms, 80 ms)
     <tr>
      <td>Extremely Fast
      <td>5
      <td>[0 ms, 20 ms)
   </table>
   <h2 class="heading settled" data-level="3" id="range-request-incxfer"><span class="secno">3. </span><span class="content">Range Request Incremental Transfer</span><a class="self-link" href="#range-request-incxfer"></a></h2>
   <p>The specification for range request based incremental transfer is currently being drafted and is
located in a separate document: <a href="RangeRequest.html">Incremental Font Transfer via Range Request</a></p>
   <h2 class="heading settled" data-level="4" id="negotiating-transfer-type"><span class="secno">4. </span><span class="content">Using Incremental Font Transfer in HTML</span><a class="self-link" href="#negotiating-transfer-type"></a></h2>
   <p>HTML content can specify that incremental font transfer can be used for a particular font URL
by using the "supports" syntax in the 'src:' attribute of a font face:</p>
<pre>@font-face {
  ...
  src: url(a_font.ttf) format(truetype supports incremental);
}
</pre>
   <p>An incrementally transferred font must be in a raw format such as truetype or opentype.
For the initial request for a font the client should assume that the server supports the patch subset
based method and send a PatchRequest via HTTP GET according to the requirements in <a href="#extend-subset">§ 2.4.2 Extending the Font Subset</a>.</p>
   <p>If the server does support the patch subset protocol it should respond appropriately following the
instructions in the patch subset section. However, if the server does not support the patch subset
protocol it should ignore the additional HTTP GET parameters and instead just begin sending the
umodified font file.</p>
   <p>If the client receives a response containing (TODO(garretrieger) add a magic number to first 4 bytes) a
PatchResponse, then follow the instructions in the Patch Subset section and all future extension
requests for this URL can be sent as patch subset requests using POST.</p>
   <p>Otherwise the client should follow the instructions in the Range Request section and all future
extension requests should be sent according the the Range Request specificiation.</p>
   <h2 class="no-num heading settled" id="priv-sec"><span class="content">Privacy and Security Considerations</span><a class="self-link" href="#priv-sec"></a></h2>
   <p class="issue" id="issue-b39f1b18"><a class="self-link" href="#issue-b39f1b18"></a> Note any issues that have been raised about privacy and security.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>
   <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
   <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="example-ae2b6bc0">
    <a class="self-link" href="#example-ae2b6bc0"></a> 
    <p>This is an example of an informative example.</p>
   </div>
   <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>
   <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>
   <h3 class="no-ref no-num heading settled" id="conformance-classes"><span class="content">Conformance Classes</span><a class="self-link" href="#conformance-classes"></a></h3>
   <p>A <dfn data-dfn-type="dfn" data-export id="conformant-user-agent">conformant user agent<a class="self-link" href="#conformant-user-agent"></a></dfn> must implement all the requirements
    listed in this specification that are applicable to user agents.</p>
   <p>A <dfn data-dfn-type="dfn" data-export id="conformant-server">conformant server<a class="self-link" href="#conformant-server"></a></dfn> must implement all the requirements listed
    in this specification that are applicable to servers.</p>
  </div>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#conformant-server">conformant server</a><span>, in §Unnumbered section</span>
   <li><a href="#conformant-user-agent">conformant user agent</a><span>, in §Unnumbered section</span>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-rfc3284">[RFC3284]
   <dd>D. Korn; et al. <a href="https://datatracker.ietf.org/doc/html/rfc3284">The VCDIFF Generic Differencing and Compression Data Format</a>. June 2002. Proposed Standard. URL: <a href="https://datatracker.ietf.org/doc/html/rfc3284">https://datatracker.ietf.org/doc/html/rfc3284</a>
   <dt id="biblio-rfc7932">[RFC7932]
   <dd>J. Alakuijala; Z. Szabadka. <a href="https://datatracker.ietf.org/doc/html/rfc7932">Brotli Compressed Data Format</a>. July 2016. Informational. URL: <a href="https://datatracker.ietf.org/doc/html/rfc7932">https://datatracker.ietf.org/doc/html/rfc7932</a>
   <dt id="biblio-rfc8949">[RFC8949]
   <dd>C. Bormann; P. Hoffman. <a href="https://datatracker.ietf.org/doc/html/rfc8949">Concise Binary Object Representation (CBOR)</a>. December 2020. Internet Standard. URL: <a href="https://datatracker.ietf.org/doc/html/rfc8949">https://datatracker.ietf.org/doc/html/rfc8949</a>
   <dt id="biblio-shared-brotli">[Shared-Brotli]
   <dd>J. Alakuijala; et al. <a href="https://datatracker.ietf.org/doc/html/draft-vandevenne-shared-brotli-format-08">Shared Brotli Compressed Data Format</a>. 27 Jul 2021. Internet Draft. URL: <a href="https://datatracker.ietf.org/doc/html/draft-vandevenne-shared-brotli-format-08">https://datatracker.ietf.org/doc/html/draft-vandevenne-shared-brotli-format-08</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-opentype-variations">[OPENTYPE-VARIATIONS]
   <dd><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otvaroverview">OpenType Font Variations Overview</a>. 23 October 2020. Note. URL: <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otvaroverview">https://docs.microsoft.com/en-us/typography/opentype/spec/otvaroverview</a>
   <dt id="biblio-pfe-report">[PFE-report]
   <dd>Chris Lilley. <a href="https://www.w3.org/TR/PFE-evaluation/">Progressive Font Enrichment: Evaluation Report</a>. 15 October 2020. Note. URL: <a href="https://www.w3.org/TR/PFE-evaluation/">https://www.w3.org/TR/PFE-evaluation/</a>
   <dt id="biblio-rfc4648">[RFC4648]
   <dd>S. Josefsson. <a href="https://datatracker.ietf.org/doc/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>. October 2006. Proposed Standard. URL: <a href="https://datatracker.ietf.org/doc/html/rfc4648">https://datatracker.ietf.org/doc/html/rfc4648</a>
   <dt id="biblio-woff2">[WOFF2]
   <dd>Vladimir Levantovsky; Raph Levien. <a href="https://www.w3.org/TR/WOFF2/">WOFF File Format 2.0</a>. 1 March 2018. REC. URL: <a href="https://www.w3.org/TR/WOFF2/">https://www.w3.org/TR/WOFF2/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> Note any issues that have been raised about privacy and security.<a href="#issue-b39f1b18"> ↵ </a></div>
  </div>