<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Incremental Font Transfer</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <meta content="Bikeshed version 5fcd28d6d, updated Tue May 30 13:12:11 2023 -0700" name="generator">
  <link href="https://www.w3.org/TR/IFT/" rel="canonical">
  <meta content="8eac27d097868a5c955b86f0a2d3be5653fe257c" name="document-revision">
<style>
.conform:hover {background: #31668f; color: white}
.conform:target {padding: 2px; border: 2px solid #AAA; background: #31668f; color: white }

table {
  width: 100%;
}

table, tr {
  border: 1px solid #aaa;
  border-collapse: collapse;
}

th, td {
  padding: 0.5rem;
}
</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)
*/
var { cursor: pointer; }
var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Incremental Font Transfer</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#ED">Editor’s Draft</a>, <time class="dt-updated" datetime="2024-02-09">9 February 2024</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/IFT/Overview.html">https://w3c.github.io/IFT/Overview.html</a>
     <dt>Latest published version:
     <dd><a href="https://www.w3.org/TR/IFT/">https://www.w3.org/TR/IFT/</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webfonts-wg@w3.org?subject=%5BIFT%5D%20YOUR%20TOPIC%20HERE">public-webfonts-wg@w3.org</a> with subject line “<kbd>[IFT] <i data-lt>… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-webfonts-wg/" rel="discussion">archives</a>)</span>
     <dd><a href="https://github.com/w3c/PFE/issues/">GitHub</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="1438"><a class="p-name fn u-url url" href="https://svgees.us/">Chris Lilley</a> (<span class="p-org org">W3C</span>)
     <dd class="editor p-author h-card vcard" data-editor-id="73905"><a class="p-name fn u-email email" href="mailto:grieger@google.com">Garret Rieger</a> (<span class="p-org org">Google Inc.</span>)
     <dd class="editor p-author h-card vcard" data-editor-id="137857"><a class="p-name fn u-email email" href="mailto:siterum@adobe.com">Skef Iterum</a> (<span class="p-org org">Adobe Inc.</span>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2024 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-software" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification defines a method to incrementally transfer fonts from server to client.

          Incremental transfer allows clients to load only the portions of the font they actually need
          which speeds up font loads and reduces data transfer needed to load the fonts. A font can
          be loaded over multiple requests where each request incrementally adds additional data.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress. </p>
   <p> If you wish to make comments regarding this document, please <a href="https://github.com/w3c/PFE/issues/new">file an issue on the specification repository</a>. </p>
   <p> This document was produced by the <a href="https://www.w3.org/groups/wg/webfonts">Web Fonts Working Group</a> </p>
   <p> This document was produced by groups operating under
  the <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/">W3C Patent Policy</a>.
  W3C maintains a <a href="https://www.w3.org/groups/wg/webfonts/ipr" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
  that page also includes instructions for disclosing a patent.
  An individual who has actual knowledge of a patent which the individual believes contains <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/#sec-Disclosure">section 6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>. </p>
   <p> This document is governed by the <a href="https://www.w3.org/2021/Process-20211102/" id="w3c_process_revision">2 November 2021 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#evaluation-report"><span class="secno">1.1</span> <span class="content">Technical Motivation: Evaluation Report</span></a>
      <li>
       <a href="#performance-considerations"><span class="secno">1.2</span> <span class="content">Performance Considerations and the use of Incremental Font Transfer</span></a>
       <ol class="toc">
        <li><a href="#reduce-requests"><span class="secno">1.2.1</span> <span class="content">Reducing the Number of Network Requests</span></a>
       </ol>
     </ol>
    <li>
     <a href="#opt-in"><span class="secno">2</span> <span class="content">Opt-In Mechanism</span></a>
     <ol class="toc">
      <li><a href="#offline-usage"><span class="secno">2.1</span> <span class="content">Offline Usage</span></a>
     </ol>
    <li><a href="#font-subset-info"><span class="secno">3</span> <span class="content">Font Subset</span></a>
    <li>
     <a href="#data-types"><span class="secno">4</span> <span class="content">Data Types</span></a>
     <ol class="toc">
      <li><a href="#uri-templates"><span class="secno">4.1</span> <span class="content">URI Templates</span></a>
     </ol>
    <li>
     <a href="#font-format-extensions"><span class="secno">5</span> <span class="content">Extensions to the Font Format</span></a>
     <ol class="toc">
      <li>
       <a href="#patch-map"><span class="secno">5.1</span> <span class="content">Patch Map Table</span></a>
       <ol class="toc">
        <li>
         <a href="#patch-map-format-1"><span class="secno">5.1.1</span> <span class="content">Patch Map Table: Format 1</span></a>
         <ol class="toc">
          <li><a href="#interpreting-patch-map-format-1"><span class="secno">5.1.1.1</span> <span class="content">Interpreting Format 1</span></a>
         </ol>
        <li><a href="#patch-map-format-2"><span class="secno">5.1.2</span> <span class="content">Patch Map Table: Format 2</span></a>
       </ol>
     </ol>
    <li>
     <a href="#font-patch-formats"><span class="secno">6</span> <span class="content">Font Patch Formats</span></a>
     <ol class="toc">
      <li><a href="#font-patch-definitions"><span class="secno">6.1</span> <span class="content">Definitions</span></a>
      <li><a href="#font-patch-formats-summary"><span class="secno">6.2</span> <span class="content">Formats Summary</span></a>
      <li>
       <a href="#shared-brotli"><span class="secno">6.3</span> <span class="content">Shared Brotli Patch</span></a>
       <ol class="toc">
        <li><a href="#apply-shared-brotli"><span class="secno">6.3.1</span> <span class="content">Applying Shared Brotli Patches</span></a>
       </ol>
      <li>
       <a href="#per-table-shared-brotli"><span class="secno">6.4</span> <span class="content">Per Table Shared Brotli</span></a>
       <ol class="toc">
        <li><a href="#apply-per-table-shared-brotli"><span class="secno">6.4.1</span> <span class="content">Applying Per Table Shared Brotli Patches</span></a>
       </ol>
      <li>
       <a href="#glyph-keyed"><span class="secno">6.5</span> <span class="content">Glyph Keyed</span></a>
       <ol class="toc">
        <li><a href="#apply-glyph-keyed"><span class="secno">6.5.1</span> <span class="content">Applying Glyph Keyed Patches</span></a>
       </ol>
     </ol>
    <li><a href="#extending-font-subset"><span class="secno">7</span> <span class="content">Extending a Font Subset</span></a>
    <li><a href="#priv"><span class="secno"></span> <span class="content">Privacy Considerations</span></a>
    <li><a href="#sec"><span class="secno"></span> <span class="content">Security Considerations</span></a>
    <li><a href="#changes"><span class="secno"></span> <span class="content">Changes</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>Incremental Font Transfer (IFT) is a technology to improve the latency of remote fonts (or "web fonts") on
the web. Without this technology, a browser needs to download every last byte of a font before it can render
any characters using that font. IFT allows the browser to download only some of the bytes in the file, thereby
decreasing the perceived latency between the time when a browser realizes it needs a font and when the
necessary text can be rendered with that font.</p>
   <p>The success of WebFonts is unevenly distributed. This specification allows WebFonts to be used where
slow networks, very large fonts, or complex subsetting requirements currently preclude their use. For
example, even using WOFF 2 <a data-link-type="biblio" href="#biblio-woff2" title="WOFF File Format 2.0">[WOFF2]</a>, fonts for CJK languages are too large to be practical.</p>
   <p>At a high level IFT works as follows:</p>
   <ul>
    <li data-md>
     <p>The client downloads an initial font file, which contains some subset of data from the original font.</p>
    <li data-md>
     <p>Inside the font file there is <a href="#font-format-extensions">embedded data</a> which informs the client about
a set of <a href="#font-patch-formats">patches</a> which are available and can be used to extend the font.</p>
    <li data-md>
     <p>The client <a href="#extending-font-subset">selects, downloads, and applies</a> these patches to extend the initial font to
cover additional characters.</p>
   </ul>
   <h3 class="heading settled" data-level="1.1" id="evaluation-report"><span class="secno">1.1. </span><span class="content">Technical Motivation: Evaluation Report</span><a class="self-link" href="#evaluation-report"></a></h3>
   <p>See the Progressive Font Enrichment: Evaluation Report <a data-link-type="biblio" href="#biblio-pfe-report" title="Progressive Font Enrichment: Evaluation Report">[PFE-report]</a> for the investigation which led
to this specification.</p>
   <h3 class="heading settled" data-level="1.2" id="performance-considerations"><span class="secno">1.2. </span><span class="content">Performance Considerations and the use of Incremental Font Transfer</span><a class="self-link" href="#performance-considerations"></a></h3>
   <p>Using incremental transfer may not always be beneficial, depending on the characteristics of the font,
the network, and the content being rendered. This section provides non-normative guidance to help decide
when incremental transfer should be utilized.</p>
   <p>Incrementally loading a font has a fundamental performance trade off versus loading the whole font.
Simplistically, under incremental transfer less bytes may be transferred at the potential cost of
increasing the total number of network requests being made, and/or increased request processing
latency. In general incremental font transfer will be beneficial where the reduction in latency from
sending less bytes outweighs additional latency introduced by the incremental transfer method.</p>
   <p>The first factor to consider is the language of the content being rendered. The evaluation report
contains the results of simulating incremental font transfer across three categories of languages
(<a href="https://www.w3.org/TR/PFE-evaluation/#langtype">Progressive Font Enrichment: Evaluation Report § langtype</a>). See it’s conclusions <a href="https://www.w3.org/TR/PFE-evaluation/#conclusions">Progressive Font Enrichment: Evaluation Report § conclusions</a> for a discussion of the
anticipated performance of incremental font transfer across the language categories.</p>
   <p>Next, how much of the font is expected to be needed? If it’s expected that most of the font will be
needed to render the content then incremental font transfer is unlikely to be beneficial. In many cases
however only part of a font is expected to be needed. For example:</p>
   <ul>
    <li data-md>
     <p>If the font contains support for several languages but a user is expected to only render content
in a subset of those languages.</p>
    <li data-md>
     <p>If the content being rendered uses a small subset of the total characters in a font. This is
often the case for Chinese, Japanese, Korean, Emoji, and Icon fonts.</p>
    <li data-md>
     <p>Only a small amount of text is being rendered. For example a font that is only used for a
headline.</p>
   </ul>
   <p>An alternative to incremental transfer is to break a font into distinct subsets (typically by script)
and use the unicode range feature of @font-face to load only the subsets needed. However, this can
break rendering <a href="https://www.w3.org/TR/PFE-evaluation/#fail-subset">Progressive Font Enrichment: Evaluation Report § fail-subset</a> if there are layout rules between characters in
different subsets. Incremental font transfer does not suffer from this issue as it maintains the
original font and all it’s layout rules.</p>
   <h4 class="heading settled" data-level="1.2.1" id="reduce-requests"><span class="secno">1.2.1. </span><span class="content">Reducing the Number of Network Requests</span><a class="self-link" href="#reduce-requests"></a></h4>
   <p>As discussed in the previous section the most basic implementation of incremental font transfer will
tend to increase the total number of requests made vs traditional font loading. Since each augmentation
will require at least one round trip time, performance can be negatively impacted if too many requests
are made. It’s possible for a client to preemptively request patches for codepoints that are not
currently needed, but expected to be needed in the future. Intelligent use of this feature by an
implementation can help reduce the total number of requests being made. The evaluation report explored
this by testing the performance of a basic character frequency based <a href="https://www.w3.org/TR/PFE-evaluation/#codepredict">codepoint prediction</a> scheme and found it improved overall performance.</p>
   <h2 class="heading settled" data-level="2" id="opt-in"><span class="secno">2. </span><span class="content">Opt-In Mechanism</span><a class="self-link" href="#opt-in"></a></h2>
   <p>Web pages can choose to opt-in to incremental transfer for a font via the use of a CSS font tech
keyword (<a href="https://drafts.csswg.org/css-fonts-4/#font-tech-definitions"><cite>CSS Fonts 4</cite> § 11.1 Font tech</a>) inside the ''@font-face'' block. The keyword <code>incremental</code> is used to indicate the referenced font contains IFT data and should
only be loaded by a user agent which supports incremental font transfer.</p>
   <div class="example" id="example-d6868efb">
    <a class="self-link" href="#example-d6868efb"></a> 
<pre>@font-face {
    font-family: "MyCoolWebFont";
    src: url("MyCoolWebFont.otf") tech(incremental);
}
</pre>
   </div>
   <p>@font-face’s that include the <code>incremental</code> tech keyword should also include a <a href="https://drafts.csswg.org/css-fonts-4/#unicode-range-desc">unicode-range descriptor</a>. This informs the client which codepoints
are available in the font prior to making the first request, which can be used to avoid requesting
the font unnecessarily.</p>
   <p class="note" role="note"><span class="marker">Note:</span> Each individual <code>@font-face</code> block may or may not opt-in to IFT. This is due to the
variety of ways fonts are used on web pages. Authors have control over which fonts they want to use
this technology with, and which they do not.</p>
   <p class="note" role="note"><span class="marker">Note:</span> the IFT tech keyword can be used in conjunction with other font tech specifiers to perform
font feature selection. For example a <code>@font-face</code> could include two URIs one with <code>tech(incremental, color-COLRv1)</code> and the other with <code>tech(incremental, color-COLRv0)</code>.</p>
   <h3 class="heading settled" data-level="2.1" id="offline-usage"><span class="secno">2.1. </span><span class="content">Offline Usage</span><a class="self-link" href="#offline-usage"></a></h3>
   <p>Special consideration must be taken when saving a page for offline usage that uses an incrementally
transferred font since the saved page won’t be able to increment the font if content changes (eg.
due to JavaScript execution). In these cases the page saving mechanism should produce the full font
by using <a href="#extending-font-subset">§ 7 Extending a Font Subset</a> to apply all available patches listed in the font.</p>
   <h2 class="heading settled" data-level="3" id="font-subset-info"><span class="secno">3. </span><span class="content">Font Subset</span><a class="self-link" href="#font-subset-info"></a></h2>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="font-subset">font subset</dfn> is a modified version of a font file <a data-link-type="biblio" href="#biblio-iso14496-22" title="Information technology — Coding of audio-visual objects — Part 22: Open Font Format">[iso14496-22]</a> that contains only the data
needed to render a subset of:</p>
   <ul>
    <li data-md>
     <p>the codepoints,</p>
    <li data-md>
     <p><a href="https://docs.microsoft.com/en-us/typography/opentype/spec/featuretags#">layout features</a>,</p>
    <li data-md>
     <p>and <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otvaroverview#terminology">design-variation space</a>.</p>
   </ul>
   <p>supported by the original font. When a subsetted font is used to render text using any combination of the subset
codepoints, <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/featuretags#">layout features</a>, or <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otvaroverview#terminology">design-variation space</a> it must render identically to the original font. This includes rendering with the use of any optional typographic
features that a renderer may choose to use from the original font, such as hinting instructions.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="font-subset-definition">font subset definition</dfn> describes the minimum data (codepoints, layout features,
variation axis space) that a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset">font subset</a> must possess.</p>
   <p class="note" role="note"><span class="marker">Note:</span> For convenience the remainder of this document links to the <a data-link-type="biblio" href="#biblio-open-type" title="OpenType Specification">[open-type]</a> specification which is a copy of <a data-link-type="biblio" href="#biblio-iso14496-22" title="Information technology — Coding of audio-visual objects — Part 22: Open Font Format">[iso14496-22]</a>.</p>
   <h2 class="heading settled" data-level="4" id="data-types"><span class="secno">4. </span><span class="content">Data Types</span><a class="self-link" href="#data-types"></a></h2>
   <p>Encoded data structures in the remainder of this specification are described in terms of the data types defined
in <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#data-types">OpenType Specification § otff#data-types</a>. As with the rest of OpenType, all fields use Big Endian byte ordering.</p>
   <h3 class="heading settled" data-level="4.1" id="uri-templates"><span class="secno">4.1. </span><span class="content">URI Templates</span><a class="self-link" href="#uri-templates"></a></h3>
   <p>URI templates <a data-link-type="biblio" href="#biblio-rfc6570" title="URI Template">[rfc6570]</a> are used to convert numeric indices into URIs where patch files are located. Given a numeric index value,
several variables are defined which are used to produce the expansion of the template:</p>
   <table>
    <tbody>
     <tr>
      <th>Variable
      <th>Value
     <tr>
      <td>id
      <td> The numeric index value converted to a string in hexadecimal representation (using the digits 0-9, A-F). No padding with 0’s is
      used. 
     <tr>
      <td>d1
      <td>The first digit (least significant digit) of the numeric index in hexadecimal.
     <tr>
      <td>d2
      <td>The second digit of the numeric index in hexadecimal, or 0 if the index does not have a second digit
     <tr>
      <td>d3
      <td>The third digit of the numeric index in hexadecimal, or 0 if the index does not have a third digit
     <tr>
      <td>d4
      <td>The fourth digit of the numeric index in hexadecimal, or 0 if the index does not have a fourth digit
   </table>
   <div class="example" id="example-2dff77c0">
    <a class="self-link" href="#example-2dff77c0"></a> 
    <p>Some example inputs and the corresponding expansions:</p>
    <table>
     <tbody>
      <tr>
       <th>Template
       <th>Input Index
       <th>Expansion
      <tr>
       <td>//foo.bar/{id}
       <td>123
       <td>//foo.bar/7B
      <tr>
       <td>//foo.bar{/d1,d2,id}
       <td>123
       <td>//foo.bar/B/7/7B
      <tr>
       <td>//foo.bar{/d1,d2,d3,id}
       <td>123
       <td>//foo.bar/B/7/0/7B
    </table>
   </div>
   <h2 class="heading settled" data-level="5" id="font-format-extensions"><span class="secno">5. </span><span class="content">Extensions to the Font Format</span><a class="self-link" href="#font-format-extensions"></a></h2>
   <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="incremental-font">incremental font</dfn> follows the existing <a data-link-type="biblio" href="#biblio-open-type" title="OpenType Specification">OpenType</a> format, but include two new <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">tables</a>:
'IFT ' and 'IFTX'. These new tables are both <a href="#patch-map">patch maps</a>, which encode a collection of mappings from <a data-link-type="dfn" href="#font-subset-definition" id="ref-for-font-subset-definition">font subset definitions</a> to URIs which host <a href="#font-patch-formats">patches</a> that extend the incremental font.
The mappings from the two tables is unioned together to produce the final mapping. All incremental fonts must contain at least an
'IFT ' table. The 'IFTX' table is optional.</p>
   <p class="note" role="note"><span class="marker">Note:</span> allowing the mapping to be split between two distinct tables allows an incremental font to more easily make use of multiple
patch types. For example all patches of one type can be specified in the 'IFT ' table, and all patches of a second type in the
'IFTX' table. Then those patches can make updates only to one of the mapping tables and avoid making conflicting updates.</p>
   <h3 class="heading settled" data-level="5.1" id="patch-map"><span class="secno">5.1. </span><span class="content">Patch Map Table</span><a class="self-link" href="#patch-map"></a></h3>
   <p>A patch map table encodes a list of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="patch-map-entries">patch map entries</dfn>, where each entry has a key and value. The key is a <a data-link-type="dfn" href="#font-subset-definition" id="ref-for-font-subset-definition①">font subset definition</a> and the value is a URI and the <a href="#font-patch-formats">§ 6 Font Patch Formats</a> used by the data at the URI. A map is
encoded in one of two formats:</p>
   <ul>
    <li data-md>
     <p>Format 1: a limited, but more compact encoding. Encodes a one-to-one mapping from glyph id to patch URIs. Does not support <a data-link-type="dfn" href="#font-subset-definition" id="ref-for-font-subset-definition②">font subset definitions</a> with design space or entries with overlapping subset definitions.</p>
    <li data-md>
     <p>Format 2: can encode arbitrary mappings including ones with design space or overlapping subset definitions. However, typically less
compact then format 1.</p>
   </ul>
   <h4 class="heading settled" data-level="5.1.1" id="patch-map-format-1"><span class="secno">5.1.1. </span><span class="content">Patch Map Table: Format 1</span><a class="self-link" href="#patch-map-format-1"></a></h4>
   <p><dfn data-dfn-type="dfn" data-noexport id="format-1-patch-map">Format 1 Patch Map<a class="self-link" href="#format-1-patch-map"></a></dfn> encoding:</p>
   <table>
    <tbody>
     <tr>
      <th>Type
      <th>Name
      <th>Description
     <tr>
      <td>uint8
      <td><dfn data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-format">format<a class="self-link" href="#format-1-patch-map-format"></a></dfn>
      <td>Set to 1, identifies this as format 1.
     <tr>
      <td>uint32
      <td><dfn data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-reserved">reserved<a class="self-link" href="#format-1-patch-map-reserved"></a></dfn>
      <td>Not used, set to 0.
     <tr>
      <td>uint32
      <td><dfn data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-id">id<a class="self-link" href="#format-1-patch-map-id"></a></dfn>[4]
      <td>Unique ID used to identify patches that are compatible with this font.
     <tr>
      <td>uint32
      <td><dfn class="dfn-paneled" data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-entrycount">entryCount</dfn>
      <td>Number of entries encoded in this table.
     <tr>
      <td>uint32
      <td><dfn class="dfn-paneled" data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-glyphcount">glyphCount</dfn>
      <td>Number of glyphs that mappings are provided for. Must match the numGlyphs field from <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/maxp#">maxp</a>.
     <tr>
      <td>Offset32
      <td><dfn data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-glyphmapoffset">glyphMapOffset<a class="self-link" href="#format-1-patch-map-glyphmapoffset"></a></dfn>
      <td>Offset to a <a data-link-type="dfn" href="#glyph-map" id="ref-for-glyph-map">Glyph Map</a> sub table. Offset is from the start of this table.
     <tr>
      <td>Offset32
      <td><dfn data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-featuremapoffset">featureMapOffset<a class="self-link" href="#format-1-patch-map-featuremapoffset"></a></dfn>
      <td>Offset to a <a data-link-type="dfn" href="#feature-map" id="ref-for-feature-map">Feature Map</a> sub table. Offset is from the start of this table.
     <tr>
      <td>uint8
      <td><dfn class="dfn-paneled" data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-appliedentriesbitmap">appliedEntriesBitMap</dfn>[(entryCount + 7)/8]
      <td> A bit map which tracks which entries have been applied. If bit <code>i</code> is set that indicates the patch for entry <code>i</code> has been applied to this font. Bit 0 is the least significant bit of appliedEntriesBitMap[0], while bit 7 is
      the most significant bit. Bit 8 is the least significant bit of appliedEntriesBitMap[1] and so on. 
     <tr>
      <td>uint16
      <td><dfn data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-uritemplatelength">uriTemplateLength<a class="self-link" href="#format-1-patch-map-uritemplatelength"></a></dfn>
      <td> Length of the uriTemplate string. 
     <tr>
      <td>uint8
      <td><dfn class="dfn-paneled" data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-uritemplate">uriTemplate</dfn>[uriTemplateLength]
      <td> A <a data-link-type="biblio" href="#biblio-utf-8" title="UTF-8, a transformation format of ISO 10646">[UTF-8]</a> encoded string. Contains a template (TODO) which is used to produce URIs associated with each entry. 
     <tr>
      <td>uint8
      <td><dfn class="dfn-paneled" data-dfn-for="Format 1 Patch Map" data-dfn-type="dfn" data-noexport id="format-1-patch-map-patchencoding">patchEncoding</dfn>
      <td> Specifies the format of the patches linked to by uriTemplate. Using the ID number from the <a href="#font-patch-formats-summary">§ 6.2 Formats Summary</a> table. 
   </table>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="glyph-map">Glyph Map</dfn> encoding:</p>
   <p>A glyph map table associates each glyph index in the font with an entry index.</p>
   <table>
    <tbody>
     <tr>
      <th>Type
      <th>Name
      <th>Description
     <tr>
      <td>uint16
      <td><dfn data-dfn-for="Glyph Map" data-dfn-type="dfn" data-noexport id="glyph-map-firstmappedglyph">firstMappedGlyph<a class="self-link" href="#glyph-map-firstmappedglyph"></a></dfn>
      <td>All glyph indices less than firstMappedGlyph are implicitly mapped to entry index 0.
     <tr>
      <td>uint8/uint16
      <td><dfn data-dfn-for="Glyph Map" data-dfn-type="dfn" data-noexport id="glyph-map-entryindex">entryIndex<a class="self-link" href="#glyph-map-entryindex"></a></dfn>[<a data-link-type="dfn" href="#format-1-patch-map-glyphcount" id="ref-for-format-1-patch-map-glyphcount">glyphCount</a> - firstMappedGlyph]
      <td> The entry index for glyph <code>i</code> is stored in entryIndex[<code>i</code> - firstMappedGlyph]. Array members
      are uint8 if <a data-link-type="dfn" href="#format-1-patch-map-entrycount" id="ref-for-format-1-patch-map-entrycount">entryCount</a> is less than 256, otherwise they are uint16. 
   </table>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="feature-map">Feature Map</dfn> encoding:</p>
   <p>A feature map table associates combinations of <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/featuretags#">feature tags</a> and glyphs with an entry index.</p>
   <table>
    <tbody>
     <tr>
      <th>Type
      <th>Name
      <th>Description
     <tr>
      <td>uint16
      <td><dfn data-dfn-for="Feature Map" data-dfn-type="dfn" data-noexport id="feature-map-featurecount">featureCount<a class="self-link" href="#feature-map-featurecount"></a></dfn>
      <td>Number of featureRecords.
     <tr>
      <td><a data-link-type="dfn" href="#featurerecord" id="ref-for-featurerecord">FeatureRecord</a>
      <td><dfn class="dfn-paneled" data-dfn-for="Feature Map" data-dfn-type="dfn" data-noexport id="feature-map-featurerecords">featureRecords</dfn>[featureCount]
      <td> Provides mappings for a specific <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/featuretags#">feature tag</a>. Must be sorted by <a data-link-type="dfn" href="#featurerecord-featuretag" id="ref-for-featurerecord-featuretag">featureTag</a> with any feature tag occurring at most once. 
     <tr>
      <td><a data-link-type="dfn" href="#entrymaprecord" id="ref-for-entrymaprecord">EntryMapRecord</a>
      <td><dfn data-dfn-for="Feature Map" data-dfn-type="dfn" data-noexport id="feature-map-entrymaprecords">entryMapRecords<a class="self-link" href="#feature-map-entrymaprecords"></a></dfn>[variable]
      <td> Provides the key (entry index) for each feature mapping. The entryMapRecords array contains as many entries as the sum of
      the <a data-link-type="dfn" href="#featurerecord-entrymapcount" id="ref-for-featurerecord-entrymapcount">entryMapCount</a> fields in the <a data-link-type="dfn" href="#feature-map-featurerecords" id="ref-for-feature-map-featurerecords">featureRecords</a> array, with entryMapRecords[0] corresponding
      to the first entry of featureRecords[0], entryMapRecords[featureRecord[0].entryMapCount] corresponding to the first entry of
      featureRecords[1], entryMapRecords[featureRecords[0].entryMapCount + featureRecord[1].entryMapCount]] corresponding to the
      first entry of featureRecords[2], and so on. 
   </table>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="featurerecord">FeatureRecord</dfn> encoding:</p>
   <table>
    <tbody>
     <tr>
      <th>Type
      <th>Name
      <th>Description
     <tr>
      <td>Tag
      <td><dfn class="dfn-paneled" data-dfn-for="FeatureRecord" data-dfn-type="dfn" data-noexport id="featurerecord-featuretag">featureTag</dfn>
      <td>The <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/featuretags#">feature tag</a> this mapping is for.
     <tr>
      <td>uint8/uint16
      <td><dfn class="dfn-paneled" data-dfn-for="FeatureRecord" data-dfn-type="dfn" data-noexport id="featurerecord-firstentryindex">firstEntryIndex</dfn>
      <td> uint8 if <a data-link-type="dfn" href="#format-1-patch-map-entrycount" id="ref-for-format-1-patch-map-entrycount①">entryCount</a> is less than 256, otherwise uint16.
      The first entry index this record maps too. 
     <tr>
      <td>uint8/uint16
      <td><dfn class="dfn-paneled" data-dfn-for="FeatureRecord" data-dfn-type="dfn" data-noexport id="featurerecord-entrymapcount">entryMapCount</dfn>
      <td> uint8 if <a data-link-type="dfn" href="#format-1-patch-map-entrycount" id="ref-for-format-1-patch-map-entrycount②">entryCount</a> is less than 256, otherwise uint16.
      The number of <a data-link-type="dfn" href="#entrymaprecord" id="ref-for-entrymaprecord①">EntryMapRecord</a>s associated with this feature. 
   </table>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="entrymaprecord">EntryMapRecord</dfn> encoding:</p>
   <table>
    <tbody>
     <tr>
      <th>Type
      <th>Name
      <th>Description
     <tr>
      <td>uint8/uint16
      <td><dfn class="dfn-paneled" data-dfn-for="EntryMapRecord" data-dfn-type="dfn" data-noexport id="entrymaprecord-firstentryindex">firstEntryIndex</dfn>
      <td> uint8 if <a data-link-type="dfn" href="#format-1-patch-map-entrycount" id="ref-for-format-1-patch-map-entrycount③">entryCount</a> is less than 256, otherwise uint16. 
     <tr>
      <td>uint8/uint16
      <td><dfn class="dfn-paneled" data-dfn-for="EntryMapRecord" data-dfn-type="dfn" data-noexport id="entrymaprecord-lastentryindex">lastEntryIndex</dfn>
      <td> uint8 if <a data-link-type="dfn" href="#format-1-patch-map-entrycount" id="ref-for-format-1-patch-map-entrycount④">entryCount</a> is less than 256, otherwise uint16.
      Must be greater than or equal to firstEntryIndex. 
   </table>
   <p>An entry map record matches any entry indices that are greater than or equal to firstEntryIndex and less than or equal to  lastEntryIndex.</p>
   <h5 class="heading settled algorithm" data-algorithm="Interpreting Format 1" data-level="5.1.1.1" id="interpreting-patch-map-format-1"><span class="secno">5.1.1.1. </span><span class="content">Interpreting Format 1</span><a class="self-link" href="#interpreting-patch-map-format-1"></a></h5>
   <p>This algorithm is convert a format 1 patch map into a list of <a data-link-type="dfn" href="#patch-map-entries" id="ref-for-patch-map-entries">patch map entries</a>.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export id="abstract-opdef-interpret-format-1-patch-map">Interpret Format 1 Patch Map</dfn></p>
   <p>The inputs to this algorithm are:</p>
   <ul>
    <li data-md>
     <p><var>patch map</var>: a <a href="#patch-map-format-1">§ 5.1.1 Patch Map Table: Format 1</a> encoded patch map.</p>
    <li data-md>
     <p><var>font subset</var>: the <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①">font subset</a> which contains <var>patch map</var>.</p>
   </ul>
   <p>The algorithm outputs:</p>
   <ul>
    <li data-md>
     <p><var>entry list</var>: a list of <a data-link-type="dfn" href="#patch-map-entries" id="ref-for-patch-map-entries①">patch map entries</a>.</p>
   </ul>
   <p>The algorithm:</p>
   <ol>
    <li data-md>
     <p>Check that the <var>patch map</var> is valid according to the requirements in <a href="#patch-map-format-1">§ 5.1.1 Patch Map Table: Format 1</a>. If it is not return an error.</p>
    <li data-md>
     <p>For each unique <var>entry index</var> in <a data-link-type="dfn" href="#glyph-map" id="ref-for-glyph-map①">Glyph Map</a>:</p>
     <ul>
      <li data-md>
       <p>a. If the bit for <var>entry index</var> in <a data-link-type="dfn" href="#format-1-patch-map-appliedentriesbitmap" id="ref-for-format-1-patch-map-appliedentriesbitmap">appliedEntriesBitMap</a> is set to 1, skip this <var>entry index</var>.</p>
      <li data-md>
       <p>b. Collect the set of glyph indices that map to the <var>entry index</var>.</p>
      <li data-md>
       <p>c. Convert the set of glyph indices to a set of unicode code points using the code point to glyph mapping in the <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/cmap#">cmap</a> table of <var>font subset</var>. Ignore any glyph indices that are not mapped by <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/cmap#">cmap</a>.</p>
      <li data-md>
       <p>d. Convert <var>entry index</var> into a URI by applying <a data-link-type="dfn" href="#format-1-patch-map-uritemplate" id="ref-for-format-1-patch-map-uritemplate">uriTemplate</a> following <a href="#uri-templates">§ 4.1 URI Templates</a>.</p>
      <li data-md>
       <p>e. Add an <a data-link-type="dfn" href="#patch-map-entries" id="ref-for-patch-map-entries②">entry</a> to <var>entry list</var> whose subset definition contains only the unicode code point set and
maps to the generated URI and the patch encoding specified by <a data-link-type="dfn" href="#format-1-patch-map-patchencoding" id="ref-for-format-1-patch-map-patchencoding">patchEncoding</a>.</p>
     </ul>
    <li data-md>
     <p>For each <a data-link-type="dfn" href="#featurerecord" id="ref-for-featurerecord①">FeatureRecord</a> and associated <a data-link-type="dfn" href="#entrymaprecord" id="ref-for-entrymaprecord②">EntryMapRecord</a> in <a data-link-type="dfn" href="#feature-map-featurerecords" id="ref-for-feature-map-featurerecords①">featureRecords</a>:</p>
     <ul>
      <li data-md>
       <p>For each <var>entry index</var> between <a data-link-type="dfn" href="#entrymaprecord-firstentryindex" id="ref-for-entrymaprecord-firstentryindex">firstEntryIndex</a> (inclusive) and <a data-link-type="dfn" href="#entrymaprecord-lastentryindex" id="ref-for-entrymaprecord-lastentryindex">lastEntryIndex</a> (inclusive), find the set of unicode codepoints associated with that entry index using the same process as in step 2b through
2c.</p>
       <ul>
        <li data-md>
         <p>Compute <var>mapped entry index</var> = <a data-link-type="dfn" href="#featurerecord-firstentryindex" id="ref-for-featurerecord-firstentryindex">FeatureRecord::firstEntryIndex</a> + <var>entry index</var> - <a data-link-type="dfn" href="#entrymaprecord-firstentryindex" id="ref-for-entrymaprecord-firstentryindex①">EntryMapRecord::firstEntryIndex</a>.</p>
        <li data-md>
         <p>Convert <var>mapped entry index</var> into a URI by applying <a data-link-type="dfn" href="#format-1-patch-map-uritemplate" id="ref-for-format-1-patch-map-uritemplate①">uriTemplate</a> following <a href="#uri-templates">§ 4.1 URI Templates</a>.</p>
        <li data-md>
         <p>If the bit for <var>mapped entry index</var> in <a data-link-type="dfn" href="#format-1-patch-map-appliedentriesbitmap" id="ref-for-format-1-patch-map-appliedentriesbitmap①">appliedEntriesBitMap</a> is set to 1, skip this <var>entry index</var>.</p>
        <li data-md>
         <p>Add an <a data-link-type="dfn" href="#patch-map-entries" id="ref-for-patch-map-entries③">entry</a> to <var>entry list</var> whose subset definition contains the unicode code point set and
a feature tag set containing only <a data-link-type="dfn" href="#featurerecord-featuretag" id="ref-for-featurerecord-featuretag①">featureTag</a>. The entry  maps to the generated URI and the patch encoding
specified by <a data-link-type="dfn" href="#format-1-patch-map-patchencoding" id="ref-for-format-1-patch-map-patchencoding①">patchEncoding</a>.</p>
       </ul>
     </ul>
   </ol>
   <h4 class="heading settled" data-level="5.1.2" id="patch-map-format-2"><span class="secno">5.1.2. </span><span class="content">Patch Map Table: Format 2</span><a class="self-link" href="#patch-map-format-2"></a></h4>
   <h2 class="heading settled" data-level="6" id="font-patch-formats"><span class="secno">6. </span><span class="content">Font Patch Formats</span><a class="self-link" href="#font-patch-formats"></a></h2>
   <p>In incremental font transfer <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset②">font subsets</a> are extended by applying patches. Due to the different
capabilities required in different situations this specification defines three different patch formats that can be used.</p>
   <h3 class="heading settled" data-level="6.1" id="font-patch-definitions"><span class="secno">6.1. </span><span class="content">Definitions</span><a class="self-link" href="#font-patch-definitions"></a></h3>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="font-patch">font patch</dfn> is a file which encodes changes to be made to an existing font file. Patches are used to extend
an existing <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset③">font subset</a> and provide expanded coverage.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="patch-format">patch format</dfn> is a specified encoding used to encode changes to be applied to a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset④">font subset</a> into a <a data-link-type="dfn" href="#font-patch" id="ref-for-font-patch">font patch</a>. Every <a data-link-type="dfn" href="#patch-format" id="ref-for-patch-format">patch format</a> has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="patch-application-algorithm">patch application algorithm</dfn> which takes a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset⑤">font subset</a> and a <a data-link-type="dfn" href="#font-patch" id="ref-for-font-patch①">font patch</a> encoded in the <a data-link-type="dfn" href="#patch-format" id="ref-for-patch-format①">patch format</a> as input and outputs a new extended <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset⑥">font subset</a>. Each <a data-link-type="dfn" href="#patch-application-algorithm" id="ref-for-patch-application-algorithm">patch application algorithm</a> can be categorized as either independent or dependent. Given a set of <a data-link-type="dfn" href="#font-patch" id="ref-for-font-patch②">font patches</a>, <code>P</code>, that are all valid to be applied to a specific <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset⑦">font subset</a>, <code>F</code>:</p>
   <ul>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dependent">dependent</dfn> patches are only valid to be applied to <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset⑧">font subset</a> <code>F</code>. Applying any patches from <code>P</code> to <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset⑨">font subset</a> <code>F</code> will change the subset and thus invalidate any remaining dependent patches
in <code>P</code>.</p>
    <li data-md>
     <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="independent">independent</dfn> patches are only valid to be applied to <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①⓪">font subset</a> <code>F</code> and any <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①①">font subset</a> derived
from F by the application of one or more independent patches from <code>P</code>.</p>
   </ul>
   <h3 class="heading settled" data-level="6.2" id="font-patch-formats-summary"><span class="secno">6.2. </span><span class="content">Formats Summary</span><a class="self-link" href="#font-patch-formats-summary"></a></h3>
   <p>The following patch formats are defined by this specification:</p>
   <table>
    <tbody>
     <tr>
      <th>Name
      <th>Type
      <th>ID
      <th>Description
     <tr>
      <td><a href="#shared-brotli">§ 6.3 Shared Brotli Patch</a>
      <td><a data-link-type="dfn" href="#dependent" id="ref-for-dependent">dependent</a>
      <td>1
      <td>A shared brotli encoded binary diff that uses the entire <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①②">font subset</a> as a base.
     <tr>
      <td><a href="#per-table-shared-brotli">§ 6.4 Per Table Shared Brotli</a>
      <td><a data-link-type="dfn" href="#dependent" id="ref-for-dependent①">dependent</a>
      <td>2
      <td>A collection of shared brotli encoded binary diffs that use tables from the <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①③">font subset</a> as bases.
     <tr>
      <td><a href="#glyph-keyed">§ 6.5 Glyph Keyed</a>
      <td><a data-link-type="dfn" href="#independent" id="ref-for-independent">independent</a>
      <td>3
      <td>Contains a collection of opaque binary blobs, each associated with a glyph id and table.
   </table>
   <p>More detailed descriptions of each algorithm can be found in the following sections.</p>
   <h3 class="heading settled" data-level="6.3" id="shared-brotli"><span class="secno">6.3. </span><span class="content">Shared Brotli Patch</span><a class="self-link" href="#shared-brotli"></a></h3>
   <p>In a shared brotli patch the target file is encoded with <a data-link-type="biblio" href="#biblio-rfc7932" title="Brotli Compressed Data Format">brotli compression</a> using the
source file as a <a href="https://datatracker.ietf.org/doc/html/draft-vandevenne-shared-brotli-format-09#section-3.2">shared LZ77 dictionary</a>. A shared brotli encoded patch consists
of a short header followed by brotli encoded data.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="shared-brotli-patch">Shared brotli patch</dfn> encoding:</p>
   <table>
    <tbody>
     <tr>
      <th>Type
      <th>Name
      <th>Description
     <tr>
      <td>Tag
      <td><dfn class="dfn-paneled" data-dfn-for="Shared brotli patch" data-dfn-type="dfn" data-noexport id="shared-brotli-patch-format">format</dfn>
      <td>Identifies the encoding as shared brotli, set to 'ifbr'
     <tr>
      <td>uint32
      <td><dfn class="dfn-paneled" data-dfn-for="Shared brotli patch" data-dfn-type="dfn" data-noexport id="shared-brotli-patch-id">id</dfn>[4]
      <td>The id of the <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①④">font subset</a> which this patch can be applied too.
     <tr>
      <td>uint8
      <td><dfn class="dfn-paneled" data-dfn-for="Shared brotli patch" data-dfn-type="dfn" data-noexport id="shared-brotli-patch-brotlistream">brotliStream</dfn>[variable]
      <td>Brotli encoded byte stream.
   </table>
   <h4 class="heading settled algorithm" data-algorithm="Applying Shared Brotli Patches" data-level="6.3.1" id="apply-shared-brotli"><span class="secno">6.3.1. </span><span class="content">Applying Shared Brotli Patches</span><a class="self-link" href="#apply-shared-brotli"></a></h4>
   <p>This algorithm is used to apply a shared brotli patch to extend a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①⑤">font subset</a> to cover additional codepoints,
features, and/or design-variation space.</p>
   <p><dfn data-dfn-type="abstract-op" data-export id="abstract-opdef-apply-shared-brotli-patch">Apply shared brotli patch<a class="self-link" href="#abstract-opdef-apply-shared-brotli-patch"></a></dfn></p>
   <p>The inputs to this algorithm are:</p>
   <ul>
    <li data-md>
     <p><var>base font subset</var>: a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①⑥">font subset</a> which is to be extended.</p>
    <li data-md>
     <p><var>patch</var>: a <a data-link-type="dfn" href="#shared-brotli-patch" id="ref-for-shared-brotli-patch">shared brotli patch</a> to be applied to <var>base font subset</var>.</p>
   </ul>
   <p>The algorithm outputs:</p>
   <ul>
    <li data-md>
     <p><var>extended font subset</var>: a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①⑦">font subset</a> that has been extended by the <var>patch</var>.</p>
   </ul>
   <p>The algorithm:</p>
   <ol>
    <li data-md>
     <p>Check that the <a data-link-type="dfn" href="#shared-brotli-patch-format" id="ref-for-shared-brotli-patch-format">format</a> field in <var>patch</var> is equal to 'ifbr', if it is
not equal then <var>patch</var> is not correctly formatted. Patch application has failed, return
an error.</p>
    <li data-md>
     <p>Check that the <a data-link-type="dfn" href="#shared-brotli-patch-id" id="ref-for-shared-brotli-patch-id">id</a> field in <var>patch</var> is equal to the at least one of the ids
found in the 'IFT ' or 'IFTX' table of <var>base font subset</var>. If there is no match, or <var>base font subset</var> does not have either an 'IFT ' or 'IFTX' table then patch application has failed,
return an error.</p>
    <li data-md>
     <p>Decode the brotli encoded data in <a data-link-type="dfn" href="#shared-brotli-patch-brotlistream" id="ref-for-shared-brotli-patch-brotlistream">brotliStream</a> following <a href="https://www.rfc-editor.org/rfc/rfc7932#section-10">Brotli Compressed Data Format § section-10</a> and
using the <var>base font subset</var> as a <a href="https://datatracker.ietf.org/doc/html/draft-vandevenne-shared-brotli-format-09#section-3.2">shared LZ77 dictionary</a>. Return the decoded
result as the <var>extended font subset</var></p>
   </ol>
   <h3 class="heading settled" data-level="6.4" id="per-table-shared-brotli"><span class="secno">6.4. </span><span class="content">Per Table Shared Brotli</span><a class="self-link" href="#per-table-shared-brotli"></a></h3>
   <p>A per table shared brotli patch contains a collection of patches which are applied to the individual <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">font tables</a> in the input font file. Each table patch is encoded with <a data-link-type="biblio" href="#biblio-rfc7932" title="Brotli Compressed Data Format">brotli compression</a> using the corresponding table from the input font file as a <a href="https://datatracker.ietf.org/doc/html/draft-vandevenne-shared-brotli-format-09#section-3.2">shared LZ77 dictionary</a>. A per table shared brotli encoded patch consists of a short header followed
by one or more brotli encoded patches. In addition to patching tables, patches may also replace (existing table data is not used)
or remove tables in a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①⑧">font subset</a>.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="per-table-shared-brotli-patch">Per table shared brotli patch</dfn> encoding:</p>
   <table>
    <tbody>
     <tr>
      <th>Type
      <th>Name
      <th>Description
     <tr>
      <td>Tag
      <td><dfn class="dfn-paneled" data-dfn-for="Per table shared brotli patch" data-dfn-type="dfn" data-noexport id="per-table-shared-brotli-patch-format">format</dfn>
      <td>Identifies the encoding as shared brotli, set to 'ifbt'
     <tr>
      <td>uint32
      <td><dfn class="dfn-paneled" data-dfn-for="Per table shared brotli patch" data-dfn-type="dfn" data-noexport id="per-table-shared-brotli-patch-id">id</dfn>[4]
      <td>The id of the <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset①⑨">font subset</a> which this patch can be applied too.
     <tr>
      <td>uint16
      <td><dfn data-dfn-for="Per table shared brotli patch" data-dfn-type="dfn" data-noexport id="per-table-shared-brotli-patch-patchescount">patchesCount<a class="self-link" href="#per-table-shared-brotli-patch-patchescount"></a></dfn>
      <td>The number of entries in the patches array.
     <tr>
      <td>Offset32
      <td><dfn class="dfn-paneled" data-dfn-for="Per table shared brotli patch" data-dfn-type="dfn" data-noexport id="per-table-shared-brotli-patch-patches">patches</dfn>[patchesCount+1]
      <td>Each entry is an offset from the start of this table to a <a data-link-type="dfn" href="#tablepatch" id="ref-for-tablepatch">TablePatch</a>. Offsets must be sorted in ascending order.
   </table>
   <p>The difference between two consecutive offsets in the <a data-link-type="dfn" href="#per-table-shared-brotli-patch-patches" id="ref-for-per-table-shared-brotli-patch-patches">patches</a> array gives the size
of that <a data-link-type="dfn" href="#tablepatch" id="ref-for-tablepatch①">TablePatch</a>.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="tablepatch">TablePatch</dfn> encoding:</p>
   <table>
    <tbody>
     <tr>
      <th>Type
      <th>Name
      <th>Description
     <tr>
      <td>Tag
      <td><dfn class="dfn-paneled" data-dfn-for="TablePatch" data-dfn-type="dfn" data-noexport id="tablepatch-tag">tag</dfn>
      <td>The tag that identifies the <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">font table</a> this patch applies too.
     <tr>
      <td>uint8
      <td><dfn class="dfn-paneled" data-dfn-for="TablePatch" data-dfn-type="dfn" data-noexport id="tablepatch-flags">flags</dfn>
      <td>Bit-field. If bit 0 (least significant bit) is set this patch replaces the existing table. If bit 1 is set this table is removed.
     <tr>
      <td>uint8
      <td><dfn class="dfn-paneled" data-dfn-for="TablePatch" data-dfn-type="dfn" data-noexport id="tablepatch-brotlistream">brotliStream</dfn>[variable]
      <td>Brotli encoded byte stream.
   </table>
   <h4 class="heading settled algorithm" data-algorithm="Applying Per Table Shared Brotli Patches" data-level="6.4.1" id="apply-per-table-shared-brotli"><span class="secno">6.4.1. </span><span class="content">Applying Per Table Shared Brotli Patches</span><a class="self-link" href="#apply-per-table-shared-brotli"></a></h4>
   <p>This algorithm is used to apply a per table shared brotli patch to extend a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset②⓪">font subset</a> to cover additional codepoints,
features, and/or design-variation space.</p>
   <p><dfn data-dfn-type="abstract-op" data-export id="abstract-opdef-apply-per-table-shared-brotli-patch">Apply per table shared brotli patch<a class="self-link" href="#abstract-opdef-apply-per-table-shared-brotli-patch"></a></dfn></p>
   <p>The inputs to this algorithm are:</p>
   <ul>
    <li data-md>
     <p><var>base font subset</var>: a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset②①">font subset</a> which is to be extended.</p>
    <li data-md>
     <p><var>patch</var>: a <a data-link-type="dfn" href="#per-table-shared-brotli-patch" id="ref-for-per-table-shared-brotli-patch">per table shared brotli patch</a> to be applied to <var>base font subset</var>.</p>
   </ul>
   <p>The algorithm outputs:</p>
   <ul>
    <li data-md>
     <p><var>extended font subset</var>: a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset②②">font subset</a> that has been extended by the <var>patch</var>.</p>
   </ul>
   <p>The algorithm:</p>
   <ol>
    <li data-md>
     <p>Check that the <a data-link-type="dfn" href="#per-table-shared-brotli-patch-format" id="ref-for-per-table-shared-brotli-patch-format">format</a> field in <var>patch</var> is equal to 'ifbt', if it is
not equal then <var>patch</var> is not correctly formatted. Patch application has failed, return
an error.</p>
    <li data-md>
     <p>Check that the <a data-link-type="dfn" href="#per-table-shared-brotli-patch-id" id="ref-for-per-table-shared-brotli-patch-id">id</a> field in <var>patch</var> is equal to the at least one of the ids
found in the 'IFT ' or 'IFTX' table of <var>base font subset</var>. If there is no match, or <var>base font subset</var> does not have either an 'IFT ' or 'IFTX' table then patch application has failed,
return an error.</p>
    <li data-md>
     <p>For each entry in <a data-link-type="dfn" href="#per-table-shared-brotli-patch-patches" id="ref-for-per-table-shared-brotli-patch-patches①">patches</a>, with index <var>i</var>:</p>
     <ul>
      <li data-md>
       <p>Find the <a data-link-type="dfn" href="#tablepatch" id="ref-for-tablepatch②">TablePatch</a> associated with index <var>i</var>. The object starts at the offset <a data-link-type="dfn" href="#per-table-shared-brotli-patch-patches" id="ref-for-per-table-shared-brotli-patch-patches②">patches[i]</a> (inclusive) and ends at the offset <a data-link-type="dfn" href="#per-table-shared-brotli-patch-patches" id="ref-for-per-table-shared-brotli-patch-patches③">patches[i+1]</a> (exclusive). Both offsets are relative to the start of
the <var>patch</var>.</p>
      <li data-md>
       <p>If an entry in <a data-link-type="dfn" href="#per-table-shared-brotli-patch-patches" id="ref-for-per-table-shared-brotli-patch-patches④">patches</a> was previously applied that has the same <a data-link-type="dfn" href="#tablepatch-tag" id="ref-for-tablepatch-tag">tag</a> as
this entry, then ignore this entry and continue the iteration to the next one. Entries are processed in same order as they
are listed in the <a data-link-type="dfn" href="#per-table-shared-brotli-patch-patches" id="ref-for-per-table-shared-brotli-patch-patches⑤">patches</a> array.</p>
      <li data-md>
       <p>If bit 0 (least significant bit) of <a data-link-type="dfn" href="#tablepatch-flags" id="ref-for-tablepatch-flags">flags</a> is set then, decode <a data-link-type="dfn" href="#tablepatch-brotlistream" id="ref-for-tablepatch-brotlistream">brotliStream</a> following <a href="https://www.rfc-editor.org/rfc/rfc7932#section-10">Brotli Compressed Data Format § section-10</a>. No shared dictionary is used. Add a <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">table</a> to <var>extended font subset</var> identified by <a data-link-type="dfn" href="#tablepatch-tag" id="ref-for-tablepatch-tag①">tag</a> with it’s contents set to the decoded <a data-link-type="dfn" href="#tablepatch-brotlistream" id="ref-for-tablepatch-brotlistream①">brotliStream</a>.</p>
      <li data-md>
       <p>If bit 1 of <a data-link-type="dfn" href="#tablepatch-flags" id="ref-for-tablepatch-flags①">flags</a> is set then, do not copy or add a <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">table</a> to <var>extended font subset</var> identified by <a data-link-type="dfn" href="#tablepatch-tag" id="ref-for-tablepatch-tag②">tag</a>.</p>
      <li data-md>
       <p>Otherwise, decode <a data-link-type="dfn" href="#tablepatch-brotlistream" id="ref-for-tablepatch-brotlistream②">brotliStream</a> following <a href="https://www.rfc-editor.org/rfc/rfc7932#section-10">Brotli Compressed Data Format § section-10</a> and using the <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">table</a> identified by <a data-link-type="dfn" href="#tablepatch-tag" id="ref-for-tablepatch-tag③">tag</a> in <var>base font subset</var> as a <a href="https://datatracker.ietf.org/doc/html/draft-vandevenne-shared-brotli-format-09#section-3.2">shared LZ77 dictionary</a>. Add a <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">table</a> to <var>extended font subset</var> identified by <a data-link-type="dfn" href="#tablepatch-tag" id="ref-for-tablepatch-tag④">tag</a> with it’s contents set to the decoded <a data-link-type="dfn" href="#tablepatch-brotlistream" id="ref-for-tablepatch-brotlistream③">brotliStream</a>.</p>
     </ul>
    <li data-md>
     <p>For each <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">table</a> in <var>base font subset</var> which has a tag that was not found in any of
the entries processed in step 3, add a copy of that table to <var>extended font subset</var>.</p>
   </ol>
   <h3 class="heading settled" data-level="6.5" id="glyph-keyed"><span class="secno">6.5. </span><span class="content">Glyph Keyed</span><a class="self-link" href="#glyph-keyed"></a></h3>
   <p>A glyph keyed patch contains a collection of data chunks that are each associated with a glyph index and a <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">font table</a>. The encoded data replaces any existing data for that glyph index in the referenced <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">table</a>. Glyph keyed patches can encode data for <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/glyf#">glyf</a>/<a href="https://docs.microsoft.com/en-us/typography/opentype/spec/loca#">loca</a>, <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/gvar#">gvar</a>, <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/cff#">CFF</a>, and <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/cff2#">CFF2</a> tables.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="glyph-keyed-patch">Glyph keyed patch</dfn> encoding:</p>
   <table>
    <tbody>
     <tr>
      <th>Type
      <th>Name
      <th>Description
     <tr>
      <td>Tag
      <td><dfn class="dfn-paneled" data-dfn-for="Glyph keyed patch" data-dfn-type="dfn" data-noexport id="glyph-keyed-patch-format">format</dfn>
      <td>Identifies the encoding as glyph keyed, set to 'ifgk'
     <tr>
      <td>uint32
      <td>reserved
      <td>Reserved for future use, set to 0.
     <tr>
      <td>uint32
      <td><dfn class="dfn-paneled" data-dfn-for="Glyph keyed patch" data-dfn-type="dfn" data-noexport id="glyph-keyed-patch-id">id</dfn>[4]
      <td>The id of the <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset②③">font subset</a> which this patch can be applied too.
     <tr>
      <td>uint32
      <td><dfn data-dfn-for="Glyph keyed patch" data-dfn-type="dfn" data-noexport id="glyph-keyed-patch-length">length<a class="self-link" href="#glyph-keyed-patch-length"></a></dfn>
      <td>The uncompressed length of <a data-link-type="dfn" href="#glyph-keyed-patch-brotlistream" id="ref-for-glyph-keyed-patch-brotlistream">brotliStream</a>.
     <tr>
      <td>uint8
      <td><dfn class="dfn-paneled" data-dfn-for="Glyph keyed patch" data-dfn-type="dfn" data-noexport id="glyph-keyed-patch-brotlistream">brotliStream</dfn>[variable]
      <td>Brotli encoded <a data-link-type="dfn" href="#glyphpatches" id="ref-for-glyphpatches">GlyphPatches</a> table.
   </table>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="glyphpatches">GlyphPatches</dfn> encoding:</p>
   <table>
    <tbody>
     <tr>
      <th>Type
      <th>Name
      <th>Description
     <tr>
      <td>uint32
      <td><dfn class="dfn-paneled" data-dfn-for="GlyphPatches" data-dfn-type="dfn" data-noexport id="glyphpatches-glyphcount">glyphCount</dfn>
      <td>The number of glyphs encoded in the patch.
     <tr>
      <td>uint8
      <td><dfn data-dfn-for="GlyphPatches" data-dfn-type="dfn" data-noexport id="glyphpatches-tablecount">tableCount<a class="self-link" href="#glyphpatches-tablecount"></a></dfn>
      <td>The number of <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">tables</a> the patch has data for.
     <tr>
      <td>uint16
      <td><dfn class="dfn-paneled" data-dfn-for="GlyphPatches" data-dfn-type="dfn" data-noexport id="glyphpatches-glyphids">glyphIds</dfn>[glyphCount]
      <td>An array of glyph indices included in the patch.
     <tr>
      <td>Tag
      <td><dfn class="dfn-paneled" data-dfn-for="GlyphPatches" data-dfn-type="dfn" data-noexport id="glyphpatches-tables">tables</dfn>[tableCount]
      <td>An array of <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">tables</a> (by tag) included in the patch.
     <tr>
      <td>Offset32
      <td><dfn class="dfn-paneled" data-dfn-for="GlyphPatches" data-dfn-type="dfn" data-noexport id="glyphpatches-glyphdataoffsets">glyphDataOffsets</dfn>[glyphCount * tableCount + 1]
      <td> An array of offsets of to glyph data for each table. The first <a data-link-type="dfn" href="#glyphpatches-glyphcount" id="ref-for-glyphpatches-glyphcount">glyphCount</a> offsets corresponding to <a data-link-type="dfn" href="#glyphpatches-tables" id="ref-for-glyphpatches-tables">tables[0]</a>, the next <a data-link-type="dfn" href="#glyphpatches-glyphcount" id="ref-for-glyphpatches-glyphcount①">glyphCount</a> offsets (if present) corresponding to <a data-link-type="dfn" href="#glyphpatches-tables" id="ref-for-glyphpatches-tables①">tables[1]</a>, and so on. All offsets are from the start of the <a data-link-type="dfn" href="#glyphpatches" id="ref-for-glyphpatches①">GlyphPatches</a> table.
      Offsets must be sorted in ascending order. 
     <tr>
      <td>uint8
      <td><dfn class="dfn-paneled" data-dfn-for="GlyphPatches" data-dfn-type="dfn" data-noexport id="glyphpatches-glyphdata">glyphData</dfn>[variable]
      <td> The actual glyph data picked out by the offsets. 
   </table>
   <p>The difference between two consecutive offsets in the <a data-link-type="dfn" href="#glyphpatches-glyphdataoffsets" id="ref-for-glyphpatches-glyphdataoffsets">glyphDataOffsets</a> array gives the size
of that glyph data.</p>
   <h4 class="heading settled algorithm" data-algorithm="Applying Glyph Keyed Patches" data-level="6.5.1" id="apply-glyph-keyed"><span class="secno">6.5.1. </span><span class="content">Applying Glyph Keyed Patches</span><a class="self-link" href="#apply-glyph-keyed"></a></h4>
   <p>This algorithm is used to apply a glyph keyed patch to extend a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset②④">font subset</a> to cover additional codepoints,
features, and/or design-variation space.</p>
   <p><dfn data-dfn-type="abstract-op" data-export id="abstract-opdef-apply-glyph-keyed-patch">Apply glyph keyed patch<a class="self-link" href="#abstract-opdef-apply-glyph-keyed-patch"></a></dfn></p>
   <p>The inputs to this algorithm are:</p>
   <ul>
    <li data-md>
     <p><var>base font subset</var>: a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset②⑤">font subset</a> which is to be extended.</p>
    <li data-md>
     <p><var>patch</var>: a <a data-link-type="dfn" href="#glyph-keyed-patch" id="ref-for-glyph-keyed-patch">glyph keyed patch</a> to be applied to <var>base font subset</var>.</p>
   </ul>
   <p>The algorithm outputs:</p>
   <ul>
    <li data-md>
     <p><var>extended font subset</var>: a <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset②⑥">font subset</a> that has been extended by the <var>patch</var>.</p>
   </ul>
   <p>The algorithm:</p>
   <ol>
    <li data-md>
     <p>Check that the <a data-link-type="dfn" href="#glyph-keyed-patch-format" id="ref-for-glyph-keyed-patch-format">format</a> field in <var>patch</var> is equal to 'ifgk', if it is
not equal then <var>patch</var> is not correctly formatted. Patch application has failed, return
an error.</p>
    <li data-md>
     <p>Check that the <a data-link-type="dfn" href="#glyph-keyed-patch-id" id="ref-for-glyph-keyed-patch-id">id</a> field in <var>patch</var> is equal to the at least one of the ids
found in the 'IFT ' or 'IFTX' table of <var>base font subset</var>. If there is no match, or <var>base font subset</var> does not have either an 'IFT ' or 'IFTX' table then patch application has failed,
return an error.</p>
    <li data-md>
     <p>Decode the brotli encoded data in <a data-link-type="dfn" href="#glyph-keyed-patch-brotlistream" id="ref-for-glyph-keyed-patch-brotlistream①">brotliStream</a> following <a href="https://www.rfc-editor.org/rfc/rfc7932#section-10">Brotli Compressed Data Format § section-10</a>. The
decoded data is a <a data-link-type="dfn" href="#glyphpatches" id="ref-for-glyphpatches②">GlyphPatches</a> table.</p>
    <li data-md>
     <p>For each <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">font table</a> listed in <a data-link-type="dfn" href="#glyphpatches-tables" id="ref-for-glyphpatches-tables②">tables</a>, with index <code>i</code>:</p>
     <ul>
      <li data-md>
       <p>Using the corresponding table in <var>base font subset</var>, synthesize
a new table where the data for each glyph is replaced with the data corresponding to that glyph index
from <a data-link-type="dfn" href="#glyphpatches-glyphdata" id="ref-for-glyphpatches-glyphdata">glyphData</a> if present, otherwise copied from the corresponding table in <var>base font subset</var> for
that glyph index.</p>
      <li data-md>
       <p>The patch glyph data for a glyph index is located by finding <a data-link-type="dfn" href="#glyphpatches-glyphids" id="ref-for-glyphpatches-glyphids">glyphIds[j]</a> equal to the glyph index. The
offset to the associated glyph data is <a data-link-type="dfn" href="#glyphpatches-glyphdataoffsets" id="ref-for-glyphpatches-glyphdataoffsets①">glyphDataOffsets[i * glyphCount + j]</a>. The length
of the associated glyph data is <a data-link-type="dfn" href="#glyphpatches-glyphdataoffsets" id="ref-for-glyphpatches-glyphdataoffsets②">glyphDataOffsets[i * glyphCount + j + 1]</a> minus <a data-link-type="dfn" href="#glyphpatches-glyphdataoffsets" id="ref-for-glyphpatches-glyphdataoffsets③">glyphDataOffsets[i * glyphCount + j]</a>.</p>
      <li data-md>
       <p>The specific process for synthesizing the new table, depends on the specified format of the <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">table</a>. Any non-glyph associated data should be copied from the table in <var>base font subset</var>. Tables of the type <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/glyf#">glyf</a>/<a href="https://docs.microsoft.com/en-us/typography/opentype/spec/loca#">loca</a>, <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/gvar#">gvar</a>, <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/cff#">CFF</a>, or <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/cff2#">CFF2</a> are supported. Entries for tables
of any other types must be ignored.</p>
      <li data-md>
       <p>If <var>base font subset</var> does not have a matching table, return an error.</p>
      <li data-md>
       <p>Insert the synthesized table into <var>extended font subset</var>.</p>
     </ul>
    <li data-md>
     <p>For each <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">table</a> in <var>base font subset</var> which has a tag that was not found in any of
the entries processed in step 4, add a copy of that table to <var>extended font subset</var>.</p>
    <li data-md>
     <p>Modify the mappings in the IFT and IFTX table(s) in <var>extended font subset</var> if present to remove any mapping entries
that map to this patch.</p>
   </ol>
   <h2 class="heading settled algorithm" data-algorithm="Extending a Font Subset" data-level="7" id="extending-font-subset"><span class="secno">7. </span><span class="content">Extending a Font Subset</span><a class="self-link" href="#extending-font-subset"></a></h2>
   <p>This sections defines the algorithm that a client uses to extend an <a data-link-type="dfn" href="#incremental-font" id="ref-for-incremental-font">incremental</a> <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset②⑦">font subset</a> to cover additional
codepoints, layout features and/or design space.</p>
   <p><dfn data-dfn-type="abstract-op" data-export id="abstract-opdef-extend-a-font-subset">Extend a Font Subset<a class="self-link" href="#abstract-opdef-extend-a-font-subset"></a></dfn></p>
   <p>The inputs to this algorithm are:</p>
   <ul>
    <li data-md>
     <p><var>font subset</var>: an <a data-link-type="dfn" href="#incremental-font" id="ref-for-incremental-font①">incremental</a> <a data-link-type="dfn" href="#font-subset" id="ref-for-font-subset②⑧">font subset</a>.</p>
    <li data-md>
     <p><var>target subset definition</var>: the <a data-link-type="dfn" href="#font-subset-definition" id="ref-for-font-subset-definition③">font subset definition</a> that the client wants to extend <var>font subset</var> to cover.</p>
   </ul>
   <p>The algorithm outputs:</p>
   <ul>
    <li data-md>
     <p><var>extended font subset</var>: an extended version of <var>font subset</var>. May or may not be an <a data-link-type="dfn" href="#incremental-font" id="ref-for-incremental-font②">incremental font</a>.</p>
   </ul>
   <p>The algorithm:</p>
   <ol>
    <li data-md>
     <p>Set <var>extended font subset</var> to <var>font subset</var>.</p>
    <li data-md>
     <p>Load the 'IFT ' and 'IFTX' (if present) mapping <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">tables</a> from <var>extended font subset</var>. Both
tables are formatted as a <a href="#patch-map">§ 5.1 Patch Map Table</a>. Check that they are valid according to the requirements in <a href="#patch-map">§ 5.1 Patch Map Table</a>. If either table
is not valid, invoke <a data-link-type="abstract-op" href="#abstract-opdef-handle-errors" id="ref-for-abstract-opdef-handle-errors">Handle errors</a>. If <var>extended font subset</var> does not have an 'IFT ' table, then it is not an <a data-link-type="dfn" href="#incremental-font" id="ref-for-incremental-font③">incremental font</a> and cannot be extended, return <var>extended font subset</var>.</p>
    <li data-md>
     <p>For each of <a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#table-directory">tables</a> 'IFT ' and 'IFTX' (if present): convert the table into a list of entries by
invoking <a data-link-type="abstract-op" href="#abstract-opdef-interpret-format-1-patch-map" id="ref-for-abstract-opdef-interpret-format-1-patch-map">Interpret Format 1 Patch Map</a>. Concatenate the output entry lists into a single list, <var>entry list</var>.</p>
    <li data-md>
     <p>For each <var>entry</var> in <var>entry list</var> invoke <a data-link-type="abstract-op" href="#abstract-opdef-check-entry-intersection" id="ref-for-abstract-opdef-check-entry-intersection">Check entry intersection</a> with <var>entry</var> and <var>target subset definition</var> as inputs, if it returns false remove <var>entry</var> from <var>entry list</var>.</p>
    <li data-md>
     <p>If <var>entry list</var> is empty then the extension operation is finished, return <var>extended font subset</var>.</p>
    <li data-md>
     <p>If <var>entry list</var> contains one or more <a data-link-type="dfn" href="#patch-map-entries" id="ref-for-patch-map-entries④">patch map entries</a> which have a patch format that is <a data-link-type="dfn" href="#dependent" id="ref-for-dependent②">dependent</a>. Select exactly
one of the <a data-link-type="dfn" href="#dependent" id="ref-for-dependent③">dependent</a> entries in <var>entry list</var> and remove all others. The criteria for selecting the single <a data-link-type="dfn" href="#dependent" id="ref-for-dependent④">dependent</a> entry is left up to the implementation to decide.</p>
    <li data-md>
     <p>For each <var>entry</var> in <var>entry list</var> invoke <a data-link-type="abstract-op" href="#abstract-opdef-load-patch-file" id="ref-for-abstract-opdef-load-patch-file">Load patch file</a> with the entries URI. Collect the returned patch
files into <var>patch list</var>.</p>
    <li data-md>
     <p>For each <var>patch</var> in <var>patch list</var> use the appropriate application algorithm (matching the patches format) from <a href="#font-patch-formats">§ 6 Font Patch Formats</a> to apply the <var>patch</var> to <var>extended font subset</var>. The order of patch application is left up to
the implementation.</p>
    <li data-md>
     <p>Go to step 2.</p>
   </ol>
   <p><dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export id="abstract-opdef-check-entry-intersection">Check entry intersection</dfn></p>
   <p>The inputs to this algorithm are:</p>
   <ul>
    <li data-md>
     <p><var>mapping entry</var>: a <a data-link-type="dfn" href="#patch-map-entries" id="ref-for-patch-map-entries⑤">patch map entry</a>.</p>
    <li data-md>
     <p><var>subset definition</var>: a <a data-link-type="dfn" href="#font-subset-definition" id="ref-for-font-subset-definition④">font subset definition</a>.</p>
   </ul>
   <p>The algorithm outputs:</p>
   <ul>
    <li data-md>
     <p><var>intersects</var>: true if <var>subset definition</var> intersects <var>mapping entry</var>, otherwise false.</p>
   </ul>
   <p>The algorithm:</p>
   <ol>
    <li data-md>
     <p>For each set in <var>subset definition</var> (codepoints, feature tags, design space) check if the set intersects
 the corresponding set from <var>mapping entry</var>. A set intersects when:</p>
     <table>
      <tbody>
       <tr>
        <th>
        <th>subset definition set is empty
        <th>subset definition set is not empty
       <tr>
        <th>mapping entry set is empty
        <td>true
        <td>true
       <tr>
        <th>mapping entry set is not empty
        <td>false
        <td>true if the two sets intersect
     </table>
    <li data-md>
     <p>If all sets checked in step 1 intersect then return true for <var>intersects</var> otherwise false.</p>
   </ol>
   <p><dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export id="abstract-opdef-load-patch-file">Load patch file</dfn></p>
   <p>The inputs to this algorithm are:</p>
   <ul>
    <li data-md>
     <p><var>URI</var>: a URI identifying the patch file to load.</p>
   </ul>
   <p>The algorithm outputs:</p>
   <ul>
    <li data-md>
     <p><var>patch file</var>: the patch file identified by <var>URI</var>.</p>
   </ul>
   <p>The algorithm:</p>
   <ol>
    <li data-md>
     <p>TODO</p>
   </ol>
   <p><dfn class="dfn-paneled" data-dfn-type="abstract-op" data-export id="abstract-opdef-handle-errors">Handle errors</dfn></p>
   <h2 class="no-num heading settled" id="priv"><span class="content">Privacy Considerations</span><a class="self-link" href="#priv"></a></h2>
   <h2 class="no-num heading settled" id="sec"><span class="content">Security Considerations</span><a class="self-link" href="#sec"></a></h2>
   <h2 class="no-num heading settled" id="changes"><span class="content">Changes</span><a class="self-link" href="#changes"></a></h2>
   <p>Since the <a href="https://www.w3.org/TR/2023/WD-IFT-20230530/">Working
  Draft of 30 May 2023</a> (see <a href="https://github.com/w3c/IFT/commits/main/Overview.bs">commit history</a>):</p>
   <ul>
    <li>Complete rewrite of the specification. Separate 'Patch Subset' and 'Range Request' methods have been removed in favour
      of a single unified approach.
   </ul>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
   </section>
  </div>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#format-1-patch-map-appliedentriesbitmap">appliedEntriesBitMap</a><span>, in § 5.1.1</span>
   <li><a href="#abstract-opdef-apply-glyph-keyed-patch">Apply glyph keyed patch</a><span>, in § 6.5.1</span>
   <li><a href="#abstract-opdef-apply-per-table-shared-brotli-patch">Apply per table shared brotli patch</a><span>, in § 6.4.1</span>
   <li><a href="#abstract-opdef-apply-shared-brotli-patch">Apply shared brotli patch</a><span>, in § 6.3.1</span>
   <li>
    brotliStream
    <ul>
     <li><a href="#glyph-keyed-patch-brotlistream">dfn for Glyph keyed patch</a><span>, in § 6.5</span>
     <li><a href="#shared-brotli-patch-brotlistream">dfn for Shared brotli patch</a><span>, in § 6.3</span>
     <li><a href="#tablepatch-brotlistream">dfn for TablePatch</a><span>, in § 6.4</span>
    </ul>
   <li><a href="#abstract-opdef-check-entry-intersection">Check entry intersection</a><span>, in § 7</span>
   <li><a href="#dependent">dependent</a><span>, in § 6.1</span>
   <li><a href="#format-1-patch-map-entrycount">entryCount</a><span>, in § 5.1.1</span>
   <li><a href="#glyph-map-entryindex">entryIndex</a><span>, in § 5.1.1</span>
   <li><a href="#featurerecord-entrymapcount">entryMapCount</a><span>, in § 5.1.1</span>
   <li><a href="#entrymaprecord">EntryMapRecord</a><span>, in § 5.1.1</span>
   <li><a href="#feature-map-entrymaprecords">entryMapRecords</a><span>, in § 5.1.1</span>
   <li><a href="#abstract-opdef-extend-a-font-subset">Extend a Font Subset</a><span>, in § 7</span>
   <li><a href="#feature-map-featurecount">featureCount</a><span>, in § 5.1.1</span>
   <li><a href="#feature-map">Feature Map</a><span>, in § 5.1.1</span>
   <li><a href="#format-1-patch-map-featuremapoffset">featureMapOffset</a><span>, in § 5.1.1</span>
   <li><a href="#featurerecord">FeatureRecord</a><span>, in § 5.1.1</span>
   <li><a href="#feature-map-featurerecords">featureRecords</a><span>, in § 5.1.1</span>
   <li><a href="#featurerecord-featuretag">featureTag</a><span>, in § 5.1.1</span>
   <li>
    firstEntryIndex
    <ul>
     <li><a href="#entrymaprecord-firstentryindex">dfn for EntryMapRecord</a><span>, in § 5.1.1</span>
     <li><a href="#featurerecord-firstentryindex">dfn for FeatureRecord</a><span>, in § 5.1.1</span>
    </ul>
   <li><a href="#glyph-map-firstmappedglyph">firstMappedGlyph</a><span>, in § 5.1.1</span>
   <li><a href="#tablepatch-flags">flags</a><span>, in § 6.4</span>
   <li><a href="#font-patch">font patch</a><span>, in § 6.1</span>
   <li><a href="#font-subset">font subset</a><span>, in § 3</span>
   <li><a href="#font-subset-definition">font subset definition</a><span>, in § 3</span>
   <li>
    format
    <ul>
     <li><a href="#format-1-patch-map-format">dfn for Format 1 Patch Map</a><span>, in § 5.1.1</span>
     <li><a href="#glyph-keyed-patch-format">dfn for Glyph keyed patch</a><span>, in § 6.5</span>
     <li><a href="#per-table-shared-brotli-patch-format">dfn for Per table shared brotli patch</a><span>, in § 6.4</span>
     <li><a href="#shared-brotli-patch-format">dfn for Shared brotli patch</a><span>, in § 6.3</span>
    </ul>
   <li><a href="#format-1-patch-map">Format 1 Patch Map</a><span>, in § 5.1.1</span>
   <li>
    glyphCount
    <ul>
     <li><a href="#format-1-patch-map-glyphcount">dfn for Format 1 Patch Map</a><span>, in § 5.1.1</span>
     <li><a href="#glyphpatches-glyphcount">dfn for GlyphPatches</a><span>, in § 6.5</span>
    </ul>
   <li><a href="#glyphpatches-glyphdata">glyphData</a><span>, in § 6.5</span>
   <li><a href="#glyphpatches-glyphdataoffsets">glyphDataOffsets</a><span>, in § 6.5</span>
   <li><a href="#glyphpatches-glyphids">glyphIds</a><span>, in § 6.5</span>
   <li><a href="#glyph-keyed-patch">Glyph keyed patch</a><span>, in § 6.5</span>
   <li><a href="#glyph-map">Glyph Map</a><span>, in § 5.1.1</span>
   <li><a href="#format-1-patch-map-glyphmapoffset">glyphMapOffset</a><span>, in § 5.1.1</span>
   <li><a href="#glyphpatches">GlyphPatches</a><span>, in § 6.5</span>
   <li><a href="#abstract-opdef-handle-errors">Handle errors</a><span>, in § 7</span>
   <li>
    id
    <ul>
     <li><a href="#format-1-patch-map-id">dfn for Format 1 Patch Map</a><span>, in § 5.1.1</span>
     <li><a href="#glyph-keyed-patch-id">dfn for Glyph keyed patch</a><span>, in § 6.5</span>
     <li><a href="#per-table-shared-brotli-patch-id">dfn for Per table shared brotli patch</a><span>, in § 6.4</span>
     <li><a href="#shared-brotli-patch-id">dfn for Shared brotli patch</a><span>, in § 6.3</span>
    </ul>
   <li><a href="#incremental-font">incremental font</a><span>, in § 5</span>
   <li><a href="#independent">independent</a><span>, in § 6.1</span>
   <li><a href="#abstract-opdef-interpret-format-1-patch-map">Interpret Format 1 Patch Map</a><span>, in § 5.1.1.1</span>
   <li><a href="#entrymaprecord-lastentryindex">lastEntryIndex</a><span>, in § 5.1.1</span>
   <li><a href="#glyph-keyed-patch-length">length</a><span>, in § 6.5</span>
   <li><a href="#abstract-opdef-load-patch-file">Load patch file</a><span>, in § 7</span>
   <li><a href="#patch-application-algorithm">patch application algorithm</a><span>, in § 6.1</span>
   <li><a href="#format-1-patch-map-patchencoding">patchEncoding</a><span>, in § 5.1.1</span>
   <li><a href="#per-table-shared-brotli-patch-patches">patches</a><span>, in § 6.4</span>
   <li><a href="#per-table-shared-brotli-patch-patchescount">patchesCount</a><span>, in § 6.4</span>
   <li><a href="#patch-format">patch format</a><span>, in § 6.1</span>
   <li><a href="#patch-map-entries">patch map entries</a><span>, in § 5.1</span>
   <li><a href="#per-table-shared-brotli-patch">Per table shared brotli patch</a><span>, in § 6.4</span>
   <li><a href="#format-1-patch-map-reserved">reserved</a><span>, in § 5.1.1</span>
   <li><a href="#shared-brotli-patch">Shared brotli patch</a><span>, in § 6.3</span>
   <li><a href="#glyphpatches-tablecount">tableCount</a><span>, in § 6.5</span>
   <li><a href="#tablepatch">TablePatch</a><span>, in § 6.4</span>
   <li><a href="#glyphpatches-tables">tables</a><span>, in § 6.5</span>
   <li><a href="#tablepatch-tag">tag</a><span>, in § 6.4</span>
   <li><a href="#format-1-patch-map-uritemplate">uriTemplate</a><span>, in § 5.1.1</span>
   <li><a href="#format-1-patch-map-uritemplatelength">uriTemplateLength</a><span>, in § 5.1.1</span>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-fonts-4">[CSS-FONTS-4]
   <dd>John Daggett; Myles Maxfield; Chris Lilley. <a href="https://drafts.csswg.org/css-fonts-4/"><cite>CSS Fonts Module Level 4</cite></a>. URL: <a href="https://drafts.csswg.org/css-fonts-4/">https://drafts.csswg.org/css-fonts-4/</a>
   <dt id="biblio-iso14496-22">[ISO14496-22]
   <dd><a href="https://www.iso.org/standard/74461.html"><cite>Information technology — Coding of audio-visual objects — Part 22: Open Font Format</cite></a>. January 2019. Published. URL: <a href="https://www.iso.org/standard/74461.html">https://www.iso.org/standard/74461.html</a>
   <dt id="biblio-open-type">[OPEN-TYPE]
   <dd><a href="https://docs.microsoft.com/en-us/typography/opentype/spec"><cite>OpenType Specification</cite></a>. December 2021. Note. URL: <a href="https://docs.microsoft.com/en-us/typography/opentype/spec">https://docs.microsoft.com/en-us/typography/opentype/spec</a>
   <dt id="biblio-pfe-report">[PFE-report]
   <dd>Chris Lilley. <a href="https://www.w3.org/TR/PFE-evaluation/"><cite>Progressive Font Enrichment: Evaluation Report</cite></a>. 15 October 2020. Note. URL: <a href="https://www.w3.org/TR/PFE-evaluation/">https://www.w3.org/TR/PFE-evaluation/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc6570">[RFC6570]
   <dd>J. Gregorio; et al. <a href="https://www.rfc-editor.org/rfc/rfc6570"><cite>URI Template</cite></a>. March 2012. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6570">https://www.rfc-editor.org/rfc/rfc6570</a>
   <dt id="biblio-rfc7932">[RFC7932]
   <dd>J. Alakuijala; Z. Szabadka. <a href="https://www.rfc-editor.org/rfc/rfc7932"><cite>Brotli Compressed Data Format</cite></a>. July 2016. Informational. URL: <a href="https://www.rfc-editor.org/rfc/rfc7932">https://www.rfc-editor.org/rfc/rfc7932</a>
   <dt id="biblio-shared-brotli">[Shared-Brotli]
   <dd>J. Alakuijala; et al. <a href="https://datatracker.ietf.org/doc/html/draft-vandevenne-shared-brotli-format-09"><cite>Shared Brotli Compressed Data Format</cite></a>. 27 Jul 2021. Internet Draft. URL: <a href="https://datatracker.ietf.org/doc/html/draft-vandevenne-shared-brotli-format-09">https://datatracker.ietf.org/doc/html/draft-vandevenne-shared-brotli-format-09</a>
   <dt id="biblio-utf-8">[UTF-8]
   <dd>F. Yergeau. <a href="https://www.rfc-editor.org/rfc/rfc3629"><cite>UTF-8, a transformation format of ISO 10646</cite></a>. November 2003. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc3629">https://www.rfc-editor.org/rfc/rfc3629</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-woff2">[WOFF2]
   <dd>Vladimir Levantovsky; Raph Levien. <a href="https://w3c.github.io/woff/woff2/"><cite>WOFF File Format 2.0</cite></a>. URL: <a href="https://w3c.github.io/woff/woff2/">https://w3c.github.io/woff/woff2/</a>
  </dl>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel-json */
window.dfnpanelData = {};
window.dfnpanelData['font-subset'] = {"dfnID": "font-subset", "url": "#font-subset", "dfnText": "font subset", "refSections": [{"refs": [{"id": "ref-for-font-subset"}], "title": "3. Font Subset"}, {"refs": [{"id": "ref-for-font-subset\u2460"}], "title": "5.1.1.1. Interpreting Format 1"}, {"refs": [{"id": "ref-for-font-subset\u2461"}], "title": "6. Font Patch Formats"}, {"refs": [{"id": "ref-for-font-subset\u2462"}, {"id": "ref-for-font-subset\u2463"}, {"id": "ref-for-font-subset\u2464"}, {"id": "ref-for-font-subset\u2465"}, {"id": "ref-for-font-subset\u2466"}, {"id": "ref-for-font-subset\u2467"}, {"id": "ref-for-font-subset\u2468"}, {"id": "ref-for-font-subset\u2460\u24ea"}, {"id": "ref-for-font-subset\u2460\u2460"}], "title": "6.1. Definitions"}, {"refs": [{"id": "ref-for-font-subset\u2460\u2461"}, {"id": "ref-for-font-subset\u2460\u2462"}], "title": "6.2. Formats Summary"}, {"refs": [{"id": "ref-for-font-subset\u2460\u2463"}], "title": "6.3. Shared Brotli Patch"}, {"refs": [{"id": "ref-for-font-subset\u2460\u2464"}, {"id": "ref-for-font-subset\u2460\u2465"}, {"id": "ref-for-font-subset\u2460\u2466"}], "title": "6.3.1. Applying Shared Brotli Patches"}, {"refs": [{"id": "ref-for-font-subset\u2460\u2467"}, {"id": "ref-for-font-subset\u2460\u2468"}], "title": "6.4. Per Table Shared Brotli"}, {"refs": [{"id": "ref-for-font-subset\u2461\u24ea"}, {"id": "ref-for-font-subset\u2461\u2460"}, {"id": "ref-for-font-subset\u2461\u2461"}], "title": "6.4.1. Applying Per Table Shared Brotli Patches"}, {"refs": [{"id": "ref-for-font-subset\u2461\u2462"}], "title": "6.5. Glyph Keyed"}, {"refs": [{"id": "ref-for-font-subset\u2461\u2463"}, {"id": "ref-for-font-subset\u2461\u2464"}, {"id": "ref-for-font-subset\u2461\u2465"}], "title": "6.5.1. Applying Glyph Keyed Patches"}, {"refs": [{"id": "ref-for-font-subset\u2461\u2466"}, {"id": "ref-for-font-subset\u2461\u2467"}], "title": "7. Extending a Font Subset"}], "external": false};
window.dfnpanelData['font-subset-definition'] = {"dfnID": "font-subset-definition", "url": "#font-subset-definition", "dfnText": "font subset definition", "refSections": [{"refs": [{"id": "ref-for-font-subset-definition"}], "title": "5. Extensions to the Font Format"}, {"refs": [{"id": "ref-for-font-subset-definition\u2460"}, {"id": "ref-for-font-subset-definition\u2461"}], "title": "5.1. Patch Map Table"}, {"refs": [{"id": "ref-for-font-subset-definition\u2462"}, {"id": "ref-for-font-subset-definition\u2463"}], "title": "7. Extending a Font Subset"}], "external": false};
window.dfnpanelData['incremental-font'] = {"dfnID": "incremental-font", "url": "#incremental-font", "dfnText": "incremental font", "refSections": [{"refs": [{"id": "ref-for-incremental-font"}, {"id": "ref-for-incremental-font\u2460"}, {"id": "ref-for-incremental-font\u2461"}, {"id": "ref-for-incremental-font\u2462"}], "title": "7. Extending a Font Subset"}], "external": false};
window.dfnpanelData['patch-map-entries'] = {"dfnID": "patch-map-entries", "url": "#patch-map-entries", "dfnText": "patch map entries", "refSections": [{"refs": [{"id": "ref-for-patch-map-entries"}, {"id": "ref-for-patch-map-entries\u2460"}, {"id": "ref-for-patch-map-entries\u2461"}, {"id": "ref-for-patch-map-entries\u2462"}], "title": "5.1.1.1. Interpreting Format 1"}, {"refs": [{"id": "ref-for-patch-map-entries\u2463"}, {"id": "ref-for-patch-map-entries\u2464"}], "title": "7. Extending a Font Subset"}], "external": false};
window.dfnpanelData['format-1-patch-map-entrycount'] = {"dfnID": "format-1-patch-map-entrycount", "url": "#format-1-patch-map-entrycount", "dfnText": "entryCount", "refSections": [{"refs": [{"id": "ref-for-format-1-patch-map-entrycount"}, {"id": "ref-for-format-1-patch-map-entrycount\u2460"}, {"id": "ref-for-format-1-patch-map-entrycount\u2461"}, {"id": "ref-for-format-1-patch-map-entrycount\u2462"}, {"id": "ref-for-format-1-patch-map-entrycount\u2463"}], "title": "5.1.1. Patch Map Table: Format 1"}], "external": false};
window.dfnpanelData['format-1-patch-map-glyphcount'] = {"dfnID": "format-1-patch-map-glyphcount", "url": "#format-1-patch-map-glyphcount", "dfnText": "glyphCount", "refSections": [{"refs": [{"id": "ref-for-format-1-patch-map-glyphcount"}], "title": "5.1.1. Patch Map Table: Format 1"}], "external": false};
window.dfnpanelData['format-1-patch-map-appliedentriesbitmap'] = {"dfnID": "format-1-patch-map-appliedentriesbitmap", "url": "#format-1-patch-map-appliedentriesbitmap", "dfnText": "appliedEntriesBitMap", "refSections": [{"refs": [{"id": "ref-for-format-1-patch-map-appliedentriesbitmap"}, {"id": "ref-for-format-1-patch-map-appliedentriesbitmap\u2460"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['format-1-patch-map-uritemplate'] = {"dfnID": "format-1-patch-map-uritemplate", "url": "#format-1-patch-map-uritemplate", "dfnText": "uriTemplate", "refSections": [{"refs": [{"id": "ref-for-format-1-patch-map-uritemplate"}, {"id": "ref-for-format-1-patch-map-uritemplate\u2460"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['format-1-patch-map-patchencoding'] = {"dfnID": "format-1-patch-map-patchencoding", "url": "#format-1-patch-map-patchencoding", "dfnText": "patchEncoding", "refSections": [{"refs": [{"id": "ref-for-format-1-patch-map-patchencoding"}, {"id": "ref-for-format-1-patch-map-patchencoding\u2460"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['glyph-map'] = {"dfnID": "glyph-map", "url": "#glyph-map", "dfnText": "Glyph Map", "refSections": [{"refs": [{"id": "ref-for-glyph-map"}], "title": "5.1.1. Patch Map Table: Format 1"}, {"refs": [{"id": "ref-for-glyph-map\u2460"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['feature-map'] = {"dfnID": "feature-map", "url": "#feature-map", "dfnText": "Feature Map", "refSections": [{"refs": [{"id": "ref-for-feature-map"}], "title": "5.1.1. Patch Map Table: Format 1"}], "external": false};
window.dfnpanelData['feature-map-featurerecords'] = {"dfnID": "feature-map-featurerecords", "url": "#feature-map-featurerecords", "dfnText": "featureRecords", "refSections": [{"refs": [{"id": "ref-for-feature-map-featurerecords"}], "title": "5.1.1. Patch Map Table: Format 1"}, {"refs": [{"id": "ref-for-feature-map-featurerecords\u2460"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['featurerecord'] = {"dfnID": "featurerecord", "url": "#featurerecord", "dfnText": "FeatureRecord", "refSections": [{"refs": [{"id": "ref-for-featurerecord"}], "title": "5.1.1. Patch Map Table: Format 1"}, {"refs": [{"id": "ref-for-featurerecord\u2460"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['featurerecord-featuretag'] = {"dfnID": "featurerecord-featuretag", "url": "#featurerecord-featuretag", "dfnText": "featureTag", "refSections": [{"refs": [{"id": "ref-for-featurerecord-featuretag"}], "title": "5.1.1. Patch Map Table: Format 1"}, {"refs": [{"id": "ref-for-featurerecord-featuretag\u2460"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['featurerecord-firstentryindex'] = {"dfnID": "featurerecord-firstentryindex", "url": "#featurerecord-firstentryindex", "dfnText": "firstEntryIndex", "refSections": [{"refs": [{"id": "ref-for-featurerecord-firstentryindex"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['featurerecord-entrymapcount'] = {"dfnID": "featurerecord-entrymapcount", "url": "#featurerecord-entrymapcount", "dfnText": "entryMapCount", "refSections": [{"refs": [{"id": "ref-for-featurerecord-entrymapcount"}], "title": "5.1.1. Patch Map Table: Format 1"}], "external": false};
window.dfnpanelData['entrymaprecord'] = {"dfnID": "entrymaprecord", "url": "#entrymaprecord", "dfnText": "EntryMapRecord", "refSections": [{"refs": [{"id": "ref-for-entrymaprecord"}, {"id": "ref-for-entrymaprecord\u2460"}], "title": "5.1.1. Patch Map Table: Format 1"}, {"refs": [{"id": "ref-for-entrymaprecord\u2461"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['entrymaprecord-firstentryindex'] = {"dfnID": "entrymaprecord-firstentryindex", "url": "#entrymaprecord-firstentryindex", "dfnText": "firstEntryIndex", "refSections": [{"refs": [{"id": "ref-for-entrymaprecord-firstentryindex"}, {"id": "ref-for-entrymaprecord-firstentryindex\u2460"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['entrymaprecord-lastentryindex'] = {"dfnID": "entrymaprecord-lastentryindex", "url": "#entrymaprecord-lastentryindex", "dfnText": "lastEntryIndex", "refSections": [{"refs": [{"id": "ref-for-entrymaprecord-lastentryindex"}], "title": "5.1.1.1. Interpreting Format 1"}], "external": false};
window.dfnpanelData['abstract-opdef-interpret-format-1-patch-map'] = {"dfnID": "abstract-opdef-interpret-format-1-patch-map", "url": "#abstract-opdef-interpret-format-1-patch-map", "dfnText": "Interpret Format 1 Patch Map", "refSections": [{"refs": [{"id": "ref-for-abstract-opdef-interpret-format-1-patch-map"}], "title": "7. Extending a Font Subset"}], "external": false};
window.dfnpanelData['font-patch'] = {"dfnID": "font-patch", "url": "#font-patch", "dfnText": "font patch", "refSections": [{"refs": [{"id": "ref-for-font-patch"}, {"id": "ref-for-font-patch\u2460"}, {"id": "ref-for-font-patch\u2461"}], "title": "6.1. Definitions"}], "external": false};
window.dfnpanelData['patch-format'] = {"dfnID": "patch-format", "url": "#patch-format", "dfnText": "patch format", "refSections": [{"refs": [{"id": "ref-for-patch-format"}, {"id": "ref-for-patch-format\u2460"}], "title": "6.1. Definitions"}], "external": false};
window.dfnpanelData['patch-application-algorithm'] = {"dfnID": "patch-application-algorithm", "url": "#patch-application-algorithm", "dfnText": "patch application algorithm", "refSections": [{"refs": [{"id": "ref-for-patch-application-algorithm"}], "title": "6.1. Definitions"}], "external": false};
window.dfnpanelData['dependent'] = {"dfnID": "dependent", "url": "#dependent", "dfnText": "dependent", "refSections": [{"refs": [{"id": "ref-for-dependent"}, {"id": "ref-for-dependent\u2460"}], "title": "6.2. Formats Summary"}, {"refs": [{"id": "ref-for-dependent\u2461"}, {"id": "ref-for-dependent\u2462"}, {"id": "ref-for-dependent\u2463"}], "title": "7. Extending a Font Subset"}], "external": false};
window.dfnpanelData['independent'] = {"dfnID": "independent", "url": "#independent", "dfnText": "independent", "refSections": [{"refs": [{"id": "ref-for-independent"}], "title": "6.2. Formats Summary"}], "external": false};
window.dfnpanelData['shared-brotli-patch'] = {"dfnID": "shared-brotli-patch", "url": "#shared-brotli-patch", "dfnText": "Shared brotli patch", "refSections": [{"refs": [{"id": "ref-for-shared-brotli-patch"}], "title": "6.3.1. Applying Shared Brotli Patches"}], "external": false};
window.dfnpanelData['shared-brotli-patch-format'] = {"dfnID": "shared-brotli-patch-format", "url": "#shared-brotli-patch-format", "dfnText": "format", "refSections": [{"refs": [{"id": "ref-for-shared-brotli-patch-format"}], "title": "6.3.1. Applying Shared Brotli Patches"}], "external": false};
window.dfnpanelData['shared-brotli-patch-id'] = {"dfnID": "shared-brotli-patch-id", "url": "#shared-brotli-patch-id", "dfnText": "id", "refSections": [{"refs": [{"id": "ref-for-shared-brotli-patch-id"}], "title": "6.3.1. Applying Shared Brotli Patches"}], "external": false};
window.dfnpanelData['shared-brotli-patch-brotlistream'] = {"dfnID": "shared-brotli-patch-brotlistream", "url": "#shared-brotli-patch-brotlistream", "dfnText": "brotliStream", "refSections": [{"refs": [{"id": "ref-for-shared-brotli-patch-brotlistream"}], "title": "6.3.1. Applying Shared Brotli Patches"}], "external": false};
window.dfnpanelData['per-table-shared-brotli-patch'] = {"dfnID": "per-table-shared-brotli-patch", "url": "#per-table-shared-brotli-patch", "dfnText": "Per table shared brotli patch", "refSections": [{"refs": [{"id": "ref-for-per-table-shared-brotli-patch"}], "title": "6.4.1. Applying Per Table Shared Brotli Patches"}], "external": false};
window.dfnpanelData['per-table-shared-brotli-patch-format'] = {"dfnID": "per-table-shared-brotli-patch-format", "url": "#per-table-shared-brotli-patch-format", "dfnText": "format", "refSections": [{"refs": [{"id": "ref-for-per-table-shared-brotli-patch-format"}], "title": "6.4.1. Applying Per Table Shared Brotli Patches"}], "external": false};
window.dfnpanelData['per-table-shared-brotli-patch-id'] = {"dfnID": "per-table-shared-brotli-patch-id", "url": "#per-table-shared-brotli-patch-id", "dfnText": "id", "refSections": [{"refs": [{"id": "ref-for-per-table-shared-brotli-patch-id"}], "title": "6.4.1. Applying Per Table Shared Brotli Patches"}], "external": false};
window.dfnpanelData['per-table-shared-brotli-patch-patches'] = {"dfnID": "per-table-shared-brotli-patch-patches", "url": "#per-table-shared-brotli-patch-patches", "dfnText": "patches", "refSections": [{"refs": [{"id": "ref-for-per-table-shared-brotli-patch-patches"}], "title": "6.4. Per Table Shared Brotli"}, {"refs": [{"id": "ref-for-per-table-shared-brotli-patch-patches\u2460"}, {"id": "ref-for-per-table-shared-brotli-patch-patches\u2461"}, {"id": "ref-for-per-table-shared-brotli-patch-patches\u2462"}, {"id": "ref-for-per-table-shared-brotli-patch-patches\u2463"}, {"id": "ref-for-per-table-shared-brotli-patch-patches\u2464"}], "title": "6.4.1. Applying Per Table Shared Brotli Patches"}], "external": false};
window.dfnpanelData['tablepatch'] = {"dfnID": "tablepatch", "url": "#tablepatch", "dfnText": "TablePatch", "refSections": [{"refs": [{"id": "ref-for-tablepatch"}, {"id": "ref-for-tablepatch\u2460"}], "title": "6.4. Per Table Shared Brotli"}, {"refs": [{"id": "ref-for-tablepatch\u2461"}], "title": "6.4.1. Applying Per Table Shared Brotli Patches"}], "external": false};
window.dfnpanelData['tablepatch-tag'] = {"dfnID": "tablepatch-tag", "url": "#tablepatch-tag", "dfnText": "tag", "refSections": [{"refs": [{"id": "ref-for-tablepatch-tag"}, {"id": "ref-for-tablepatch-tag\u2460"}, {"id": "ref-for-tablepatch-tag\u2461"}, {"id": "ref-for-tablepatch-tag\u2462"}, {"id": "ref-for-tablepatch-tag\u2463"}], "title": "6.4.1. Applying Per Table Shared Brotli Patches"}], "external": false};
window.dfnpanelData['tablepatch-flags'] = {"dfnID": "tablepatch-flags", "url": "#tablepatch-flags", "dfnText": "flags", "refSections": [{"refs": [{"id": "ref-for-tablepatch-flags"}, {"id": "ref-for-tablepatch-flags\u2460"}], "title": "6.4.1. Applying Per Table Shared Brotli Patches"}], "external": false};
window.dfnpanelData['tablepatch-brotlistream'] = {"dfnID": "tablepatch-brotlistream", "url": "#tablepatch-brotlistream", "dfnText": "brotliStream", "refSections": [{"refs": [{"id": "ref-for-tablepatch-brotlistream"}, {"id": "ref-for-tablepatch-brotlistream\u2460"}, {"id": "ref-for-tablepatch-brotlistream\u2461"}, {"id": "ref-for-tablepatch-brotlistream\u2462"}], "title": "6.4.1. Applying Per Table Shared Brotli Patches"}], "external": false};
window.dfnpanelData['glyph-keyed-patch'] = {"dfnID": "glyph-keyed-patch", "url": "#glyph-keyed-patch", "dfnText": "Glyph keyed patch", "refSections": [{"refs": [{"id": "ref-for-glyph-keyed-patch"}], "title": "6.5.1. Applying Glyph Keyed Patches"}], "external": false};
window.dfnpanelData['glyph-keyed-patch-format'] = {"dfnID": "glyph-keyed-patch-format", "url": "#glyph-keyed-patch-format", "dfnText": "format", "refSections": [{"refs": [{"id": "ref-for-glyph-keyed-patch-format"}], "title": "6.5.1. Applying Glyph Keyed Patches"}], "external": false};
window.dfnpanelData['glyph-keyed-patch-id'] = {"dfnID": "glyph-keyed-patch-id", "url": "#glyph-keyed-patch-id", "dfnText": "id", "refSections": [{"refs": [{"id": "ref-for-glyph-keyed-patch-id"}], "title": "6.5.1. Applying Glyph Keyed Patches"}], "external": false};
window.dfnpanelData['glyph-keyed-patch-brotlistream'] = {"dfnID": "glyph-keyed-patch-brotlistream", "url": "#glyph-keyed-patch-brotlistream", "dfnText": "brotliStream", "refSections": [{"refs": [{"id": "ref-for-glyph-keyed-patch-brotlistream"}], "title": "6.5. Glyph Keyed"}, {"refs": [{"id": "ref-for-glyph-keyed-patch-brotlistream\u2460"}], "title": "6.5.1. Applying Glyph Keyed Patches"}], "external": false};
window.dfnpanelData['glyphpatches'] = {"dfnID": "glyphpatches", "url": "#glyphpatches", "dfnText": "GlyphPatches", "refSections": [{"refs": [{"id": "ref-for-glyphpatches"}, {"id": "ref-for-glyphpatches\u2460"}], "title": "6.5. Glyph Keyed"}, {"refs": [{"id": "ref-for-glyphpatches\u2461"}], "title": "6.5.1. Applying Glyph Keyed Patches"}], "external": false};
window.dfnpanelData['glyphpatches-glyphcount'] = {"dfnID": "glyphpatches-glyphcount", "url": "#glyphpatches-glyphcount", "dfnText": "glyphCount", "refSections": [{"refs": [{"id": "ref-for-glyphpatches-glyphcount"}, {"id": "ref-for-glyphpatches-glyphcount\u2460"}], "title": "6.5. Glyph Keyed"}], "external": false};
window.dfnpanelData['glyphpatches-glyphids'] = {"dfnID": "glyphpatches-glyphids", "url": "#glyphpatches-glyphids", "dfnText": "glyphIds", "refSections": [{"refs": [{"id": "ref-for-glyphpatches-glyphids"}], "title": "6.5.1. Applying Glyph Keyed Patches"}], "external": false};
window.dfnpanelData['glyphpatches-tables'] = {"dfnID": "glyphpatches-tables", "url": "#glyphpatches-tables", "dfnText": "tables", "refSections": [{"refs": [{"id": "ref-for-glyphpatches-tables"}, {"id": "ref-for-glyphpatches-tables\u2460"}], "title": "6.5. Glyph Keyed"}, {"refs": [{"id": "ref-for-glyphpatches-tables\u2461"}], "title": "6.5.1. Applying Glyph Keyed Patches"}], "external": false};
window.dfnpanelData['glyphpatches-glyphdataoffsets'] = {"dfnID": "glyphpatches-glyphdataoffsets", "url": "#glyphpatches-glyphdataoffsets", "dfnText": "glyphDataOffsets", "refSections": [{"refs": [{"id": "ref-for-glyphpatches-glyphdataoffsets"}], "title": "6.5. Glyph Keyed"}, {"refs": [{"id": "ref-for-glyphpatches-glyphdataoffsets\u2460"}, {"id": "ref-for-glyphpatches-glyphdataoffsets\u2461"}, {"id": "ref-for-glyphpatches-glyphdataoffsets\u2462"}], "title": "6.5.1. Applying Glyph Keyed Patches"}], "external": false};
window.dfnpanelData['glyphpatches-glyphdata'] = {"dfnID": "glyphpatches-glyphdata", "url": "#glyphpatches-glyphdata", "dfnText": "glyphData", "refSections": [{"refs": [{"id": "ref-for-glyphpatches-glyphdata"}], "title": "6.5.1. Applying Glyph Keyed Patches"}], "external": false};
window.dfnpanelData['abstract-opdef-check-entry-intersection'] = {"dfnID": "abstract-opdef-check-entry-intersection", "url": "#abstract-opdef-check-entry-intersection", "dfnText": "Check entry intersection", "refSections": [{"refs": [{"id": "ref-for-abstract-opdef-check-entry-intersection"}], "title": "7. Extending a Font Subset"}], "external": false};
window.dfnpanelData['abstract-opdef-load-patch-file'] = {"dfnID": "abstract-opdef-load-patch-file", "url": "#abstract-opdef-load-patch-file", "dfnText": "Load patch file", "refSections": [{"refs": [{"id": "ref-for-abstract-opdef-load-patch-file"}], "title": "7. Extending a Font Subset"}], "external": false};
window.dfnpanelData['abstract-opdef-handle-errors'] = {"dfnID": "abstract-opdef-handle-errors", "url": "#abstract-opdef-handle-errors", "dfnText": "Handle errors", "refSections": [{"refs": [{"id": "ref-for-abstract-opdef-handle-errors"}], "title": "7. Extending a Font Subset"}], "external": false};
</script>
<script>/* Boilerplate: script-dom-helper */
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
/*
Color-choosing design:

Colors are ordered by goodness.
Each color has a usage count (initially zero).
Each variable has a last-used color.

* If the var has a last-used color, and that color's usage is 0,
    return that color.
* Otherwise, return the lowest-indexed color with the lowest usage.
    Increment the color's usage and set it as the last-used color
    for that var.
* On unclicking, decrement usage of the color.
*/
"use strict";
{
    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    const indexCounts = new Map();
    const indexNames = new Map();
    function highlightSameAlgoVars(v) {
        // Find the algorithm container.
        let algoContainer = null;
        let searchEl = v;
        while(algoContainer == null && searchEl != document.body) {
            searchEl = searchEl.parentNode;
            if(searchEl.hasAttribute("data-algorithm")) {
                algoContainer = searchEl;
            }
        }

        // Not highlighting document-global vars,
        // too likely to be unrelated.
        if(algoContainer == null) return;

        const algoName = algoContainer.getAttribute("data-algorithm");
        const varName = getVarName(v);
        const addClass = !v.classList.contains("selected");
        let highlightClass = null;
        if(addClass) {
            const index = chooseHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] += 1;
            indexNames.set(algoName+"///"+varName, index);
            highlightClass = nameFromIndex(index);
        } else {
            const index = previousHighlightIndex(algoName, varName);
            indexCounts.get(algoName)[index] -= 1;
            highlightClass = nameFromIndex(index);
        }

        // Find all same-name vars, and toggle their class appropriately.
        for(const el of algoContainer.querySelectorAll("var")) {
            if(getVarName(el) == varName) {
                el.classList.toggle("selected", addClass);
                el.classList.toggle(highlightClass, addClass);
            }
        }
    }
    function getVarName(el) {
        return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
    }
    function chooseHighlightIndex(algoName, varName) {
        let indexes = null;
        if(indexCounts.has(algoName)) {
            indexes = indexCounts.get(algoName);
        } else {
            // 7 classes right now
            indexes = [0,0,0,0,0,0,0];
            indexCounts.set(algoName, indexes);
        }

        // If the element was recently unclicked,
        // *and* that color is still unclaimed,
        // give it back the same color.
        const lastIndex = previousHighlightIndex(algoName, varName);
        if(indexes[lastIndex] === 0) return lastIndex;

        // Find the earliest index with the lowest count.
        const minCount = Math.min.apply(null, indexes);
        let index = null;
        for(var i = 0; i < indexes.length; i++) {
            if(indexes[i] == minCount) {
                return i;
            }
        }
    }
    function previousHighlightIndex(algoName, varName) {
        return indexNames.get(algoName+"///"+varName);
    }
    function nameFromIndex(index) {
        return "selected" + index;
    }
}
</script>